<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>hivesqlä¼˜åŒ–</title>
    <link href="/2022/03/04/hivesql%E4%BC%98%E5%8C%96/"/>
    <url>/2022/03/04/hivesql%E4%BC%98%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<h1 id="å¦‚ä½•å†™å¥½ä¸€ä¸ªhql"><a href="#å¦‚ä½•å†™å¥½ä¸€ä¸ªhql" class="headerlink" title="å¦‚ä½•å†™å¥½ä¸€ä¸ªhql"></a>å¦‚ä½•å†™å¥½ä¸€ä¸ªhql</h1><p>&amp;emsp;&amp;emsp;ä½œä¸ºä¸€ä¸ªæ•°æ®å¼€å‘å·¥ç¨‹å¸ˆï¼Œhive sqlæ˜¯æˆ‘ä»¬å¿…å¤‡çš„æŠ€èƒ½ï¼Œå¯èƒ½å¤§å®¶éƒ½çŸ¥é“ä¸€äº›åŸºæœ¬çš„ä¼˜åŒ–æ–¹æ³•ï¼ˆä¾‹å¦‚ï¼šä½¿ç”¨åˆ†åŒºã€å°è¡¨joinå¤§è¡¨ã€ä¸ä½¿ç”¨distinctã€whereæ¡ä»¶å°½é‡å†™åˆ°è‡ªæŸ¥è¯¢é‡Œé¢å‡å°‘æ•°æ®é‡ç­‰ç­‰ï¼‰ï¼Œ<br>ä½†æ˜¯ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ä¸ºä»€ä¹ˆï¼Ÿæ˜¯ä¸æ˜¯çœŸçš„å¯¹æ‰§è¡Œæ•ˆç‡æœ‰æå‡ã€‚</p><p>&amp;emsp;&amp;emsp;ä¸‹é¢ä¸ºå¤§å®¶ä»‹ç»ä¸€ä¸‹hiveçš„ä¼˜åŒ–å™¨ä»¥åŠä¸€äº›å¸¸è§çš„sqlæŠ€å·§ã€‚</p><h2 id="å¸¸è§çš„ä¼˜åŒ–å™¨"><a href="#å¸¸è§çš„ä¼˜åŒ–å™¨" class="headerlink" title="å¸¸è§çš„ä¼˜åŒ–å™¨"></a>å¸¸è§çš„ä¼˜åŒ–å™¨</h2><p>&amp;emsp;&amp;emsp;å¦‚æœä½ æƒ³æŸ¥çœ‹hiveçš„ä¼˜åŒ–å™¨ï¼Œå¯ä»¥ä»githubä¸Šé¢æ‹‰ä¸€ä»½hiveçš„æºç ï¼Œåœ¨org.apache.hadoop.hive.ql.optimizerç›®å½•ä¸‹å¯ä»¥çœ‹åˆ°hiveé‡Œé¢æœ‰å“ªäº›é€»è¾‘ä¼˜åŒ–å™¨ã€‚ </p><p>ä¸‹é¢ä»‹ç»ä¸€äº›å¸¸è§å¤šä¼˜åŒ–å™¨:</p><h3 id="åˆ—è£å‰ªä¼˜åŒ–å™¨"><a href="#åˆ—è£å‰ªä¼˜åŒ–å™¨" class="headerlink" title="åˆ—è£å‰ªä¼˜åŒ–å™¨"></a>åˆ—è£å‰ªä¼˜åŒ–å™¨</h3><p>å®˜æ–¹è§£é‡Š    </p><blockquote><p>Implementation of one of the rule-based optimization steps. ColumnPruner gets<br>the current operator tree. The  tree is traversed to find out the columns<br>used for all the base tables. If all the columns for a table are not used, a<br>select is pushed on top of that table (to select only those columns). Since<br>this changes the row resolver, the tree is built again. This can be optimized<br>later to patch the tree</p></blockquote><p>&amp;emsp;&amp;emsp;æˆ‘ä»¬sqlä¸­éƒ½ä¼šç”¨åˆ°åˆ—è£å‰ªã€‚æ‰€è°“åˆ—è£å‰ªå°±æ˜¯åœ¨æŸ¥è¯¢æ—¶åªè¯»å–éœ€è¦çš„åˆ—ï¼Œåˆ†åŒºè£å‰ªå°±æ˜¯åªè¯»å–éœ€è¦çš„åˆ†åŒºã€‚ä»¥æˆ‘ä»¬çš„æ—¥å†è®°å½•è¡¨ä¸ºä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> uid,uname,sex<br><span class="hljs-keyword">from</span> user_info<br><span class="hljs-keyword">where</span> dt <span class="hljs-operator">&gt;=</span> <span class="hljs-string">&#x27;20190201&#x27;</span> <span class="hljs-keyword">and</span> dt <span class="hljs-operator">&lt;=</span> <span class="hljs-string">&#x27;20190224&#x27;</span><br><span class="hljs-keyword">and</span> age <span class="hljs-operator">=</span> <span class="hljs-number">18</span>;<br></code></pre></td></tr></table></figure><p>&amp;emsp;&amp;emsp;å½“åˆ—å¾ˆå¤šæˆ–è€…æ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œå¦‚æœselect * æˆ–è€…ä¸æŒ‡å®šåˆ†åŒºï¼Œå…¨åˆ—æ‰«æå’Œå…¨è¡¨æ‰«ææ•ˆç‡éƒ½å¾ˆä½ã€‚</p><p>&amp;emsp;&amp;emsp;Hiveä¸­ä¸åˆ—è£å‰ªä¼˜åŒ–ç›¸å…³çš„é…ç½®é¡¹æ˜¯hive.optimize.cpï¼Œä¸åˆ†åŒºè£å‰ªä¼˜åŒ–ç›¸å…³çš„åˆ™æ˜¯hive.optimize.prunerï¼Œé»˜è®¤éƒ½æ˜¯trueã€‚åœ¨HiveSQLè§£æé˜¶æ®µå¯¹åº”çš„åˆ™æ˜¯ColumnPruneré€»è¾‘ä¼˜åŒ–å™¨ã€‚</p><h3 id="PDD-Predicate-Pushdown"><a href="#PDD-Predicate-Pushdown" class="headerlink" title="PDD(Predicate Pushdown)"></a>PDD(Predicate Pushdown)</h3><p>&amp;emsp;&amp;emsp;è°“è¯ä¸‹æ¨ä¼˜åŒ–å™¨ï¼Œåœ¨è®¸å¤šæ•°æ®åº“ä¸­éƒ½ä¼šä½¿ç”¨åˆ°ï¼Œç®€å•è¯´å°±æ˜¯æŠŠåé¢çš„æŸ¥è¯¢æ¡ä»¶å‰ç½®ï¼Œä»¥ä¸‹é¢sqlæ¥è®²ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <br>    a.<span class="hljs-operator">*</span>, b.<span class="hljs-operator">*</span> <br><span class="hljs-keyword">from</span> a <span class="hljs-keyword">join</span> b <br><span class="hljs-keyword">on</span>  (a.col1 <span class="hljs-operator">=</span> b.col1) <br><span class="hljs-keyword">where</span> a.col1 <span class="hljs-operator">&gt;</span> <span class="hljs-number">20</span> <span class="hljs-keyword">and</span> b.col2 <span class="hljs-operator">&gt;</span> <span class="hljs-number">40</span><br></code></pre></td></tr></table></figure><p>&amp;emsp;&amp;emsp;å¤§éƒ¨åˆ†äººå¯èƒ½è®¤ä¸ºåº”è¯¥é€šè¿‡å°† a.col1 &gt; 20 and b.col2 &gt; 40 æ”¾åˆ°aè¡¨å’Œbè¡¨é‡Œåšå­æŸ¥è¯¢ï¼Œå‡å°‘æ•°æ®é‡è¾“å…¥ï¼Œè¿™æ ·åšæ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä½†æ˜¯ä¸Šé¢è¿™ç§å†™æ³•ï¼Œé€šè¿‡è°“è¯ä¸‹æ¨ä¼˜åŒ–å™¨å¯ä»¥å®ç°åœ¨è¯»å–aè¡¨å’Œbè¡¨çš„åŒæ—¶å°†ä¸ç¬¦åˆæ¡ä»¶çš„æ•°æ®è¿‡æ»¤æ‰ã€‚æ‰€ä»¥æœ‰æ—¶å€™ä¸éœ€è¦é€šè¿‡å†™è‡ªæŸ¥è¯¢å‡å°‘æ•°æ®é‡è¾“å…¥ï¼Œä¸Šé¢è¿™ç§è¯­æ³•æ›´åŠ å¹²å‡€æ•´æ´ã€‚<br><img src="https://imgkr2.cn-bj.ufileos.com/4204e83a-ac8b-4f06-89c1-a6d83eb607ab.png?UCloudPublicKey=TOKEN_8d8b72be-579a-4e83-bfd0-5f6ce1546f13&Signature=gvJf8bmzD2t1dyuo4%252BLiYY9%252Fe0A%253D&Expires=1603780357"></p><h3 id="mapjoin"><a href="#mapjoin" class="headerlink" title="mapjoin"></a>mapjoin</h3><blockquote><p>Map joins have restrictions on which joins can be converted  as memory restrictions</p></blockquote><p>&amp;emsp;&amp;emsp;ç®€å•æ¥è¯´map joinå°±æ˜¯æŠŠå°è¡¨åŠ å…¥åˆ°å†…å­˜ä¸­ï¼Œç›´æ¥æŠŠç›¸åŒçš„keyè¿›è¡Œjoinå¤„ç†ï¼Œå‡å°‘shuffleè¿‡ç¨‹ï¼Œå¯ä»¥æå¤§æé«˜å·¥ä½œæ•ˆç‡ï¼Œé€‚ç”¨äºç è¡¨æˆ–è€…ä¸€äº›å¤§è¡¨å’Œå°è¡¨joinçš„æƒ…å†µã€‚<br>ä¸‹é¢æ˜¯æ‰§è¡Œæµç¨‹å›¾ï¼š   </p><p><img src="https://imgkr2.cn-bj.ufileos.com/962b5bcd-4542-4034-88b0-f6c51c04fe38.png?UCloudPublicKey=TOKEN_8d8b72be-579a-4e83-bfd0-5f6ce1546f13&Signature=1%252BLKX1ieElTacJ5DUyecho5ahYo%253D&Expires=1603780900"></p><p>&amp;emsp;&amp;emsp;1.å…ˆå¯åŠ¨Task Aï¼›Task Aå¯åŠ¨ä¸€ä¸ªMapReduceçš„local taskï¼›é€šè¿‡è¯¥local taskæŠŠsmall table dataçš„æ•°æ®è¯»å–è¿›æ¥ï¼›ä¹‹åä¼šç”Ÿæˆä¸€ä¸ªHashTable Filesï¼›ä¹‹åå°†è¯¥æ–‡ä»¶åŠ è½½åˆ°åˆ†å¸ƒå¼ç¼“å­˜ä¸­ï¼›  </p><p>&amp;emsp;&amp;emsp;2.å¯åŠ¨MapJoin Taskï¼Œè¯»å¤§è¡¨çš„æ•°æ®ï¼Œæ¯è¯»ä¸€ä¸ªå°±ä¼šå’ŒDistributed Cacheä¸­çš„æ•°æ®å…³è”ä¸€æ¬¡ï¼Œå…³è”ä¸Šåè¿›è¡Œè¾“å‡ºï¼Œæ•´ä¸ªé˜¶æ®µä¸­æ²¡æœ‰reduce å’Œ shuffleã€‚   </p><h3 id="SkewJoinOptimizer"><a href="#SkewJoinOptimizer" class="headerlink" title="SkewJoinOptimizer"></a>SkewJoinOptimizer</h3><p>&amp;emsp;&amp;emsp;æ•°æ®å€¾æ–œä¼˜åŒ–å™¨ï¼šä¸»è¦åº”ç”¨åœ¨å‘ç”Ÿå€¾æ–œçš„ä»»åŠ¡ä¸­ã€‚æ•°æ®å€¾æ–œçš„æƒ…å†µç›¸ä¿¡å¤§å®¶ä¹Ÿç»å¸¸é‡åˆ°ï¼Œå¦‚mapreduceä»»åŠ¡è¿›åº¦é•¿æ—¶é—´ç­‰å¾…åœ¨99%æˆ–è€…ä¸€äº›å†…å­˜æº¢å‡ºçš„æƒ…å†µç­‰ã€‚äº§ç”Ÿæ•°æ®å€¾æ–œçš„åŸå› <br>æœ‰å¾ˆå¤šç§ï¼Œå€¾æ–œçš„åŸç†æ˜¯å¾ˆå¤šç›¸åŒçš„keyç”¨åŒä¸€ä¸ªreduceå¤„ç†ï¼Œå¯¼è‡´å¤„ç†çš„ä»»åŠ¡è¿‡å¤§ï¼Œå¦‚å…±æœ‰200äº¿æ•°æ®ï¼Œæœ‰100äº¿ä¸ºç”·ç”Ÿ 100äº¿ä¸ºå¥³ç”Ÿï¼Œå¦‚å›¾åªæœ‰ä¸¤ä¸ªreduceå¤„ç†æ•°æ®ï¼š<br><img src="https://imgkr2.cn-bj.ufileos.com/ccf26603-6bf7-41b0-9578-3f3a5bde46e5.png?UCloudPublicKey=TOKEN_8d8b72be-579a-4e83-bfd0-5f6ce1546f13&Signature=6Cir%252FhykcrQsbXh1RqUK9FA7c7U%253D&Expires=1603780606"><br>ä¸Šè¿°æƒ…å†µå‘ç”Ÿäº†æ•°æ®å€¾æ–œï¼Œä¸¤ä¸ªreduceæ‰¿å—äº†æ‰€æœ‰çš„å‹åŠ›ï¼Œä¸ä¼šæœ‰ç¬¬ä¸‰ä¸ªreduceå¤„ç†æ•°æ®ã€‚   </p><p>&amp;emsp;&amp;emsp;hiveå€¾æ–œçš„ä¼˜åŒ–å™¨æŠŠä¸€ä¸ªshuffleæ‹†åˆ†æˆä¸¤ä¸ªshuffleè¿‡ç¨‹ï¼š<br>   &amp;emsp;&amp;emsp;1ã€ç¬¬ä¸€ä¸ªshuffleè¿‡ç¨‹ï¼šç»™keyå¢åŠ ä¸€ä¸ªéšæœºæ•°ï¼Œå› æ­¤ç”Ÿæˆçš„hashå€¼ä¹Ÿä¸å°½ç›¸åŒï¼Œç›¸åŒçš„éšæœºæ•°+ç›¸åŒçš„åŸkeyç”Ÿæˆçš„hashå€¼ä¾ç„¶ä¸€æ ·ï¼Œå¦‚æ­¤æ•°æ®å°±ä¼šæ”¾åˆ°ä¸€èµ·ï¼›   </p><p><img src="https://imgkr2.cn-bj.ufileos.com/f04b86fb-644d-45a5-8362-b3d2d0b21be8.png?UCloudPublicKey=TOKEN_8d8b72be-579a-4e83-bfd0-5f6ce1546f13&Signature=4uAl48Dw0X6og0gbrltsOb5cQJ0%253D&Expires=1603781123"></p><p>   &amp;emsp;&amp;emsp;2ã€ç¬¬äºŒä¸ªshuffleè¿‡ç¨‹ï¼šå°†å‰è¾¹çš„éšæœºæ•°å»æ‰ï¼Œé‡æ–°èšåˆå¯ä»¥å¾—åˆ°æƒ³è¦çš„ç»“æœã€‚<br>   <img src="https://imgkr2.cn-bj.ufileos.com/8368bd2f-b78b-4c8c-b0e0-a426664e2a08.png?UCloudPublicKey=TOKEN_8d8b72be-579a-4e83-bfd0-5f6ce1546f13&Signature=HR94ELNm5UZco8EtmUYz5jd%252B%252BmI%253D&Expires=1603781149"></p><blockquote><p>é€šè¿‡åˆ†æ‰¹å¤„ç†è§£å†³æ•°æ®å€¾æ–œé—®é¢˜çš„æ–¹æ¡ˆä¹Ÿæ˜¯åœ¨sparkç­‰å…¶ä»–å¤§æ•°æ®è®¡ç®—å¼•æ“ä¸­é€šç”¨ä¸”æœ‰æ•ˆçš„æ–¹æ³•ã€‚</p></blockquote><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>&amp;emsp;&amp;emsp;hiveçš„ä¼˜åŒ–å™¨å…¶å®å¾ˆå¤šï¼Œé€šè¿‡å­¦ä¹ hiveä¼˜åŒ–å™¨çš„åŸç†ï¼Œè®©æˆ‘ä»¬å¯ä»¥å†™å‡ºæ•ˆç‡æ›´é«˜çš„sqlï¼Œå¦‚æœæœ‰å…´è¶£çš„è¯å¯ä»¥ä»githubä¸‹è½½hiveæºç å»å­¦ä¹ æ›´å¤šä¼˜åŒ–å™¨çš„è¯¦ç»†å†…å®¹ã€‚</p><h2 id="hqlè¯­æ³•è¿›é˜¶ä¸å¸¸ç”¨å°æŠ€å·§"><a href="#hqlè¯­æ³•è¿›é˜¶ä¸å¸¸ç”¨å°æŠ€å·§" class="headerlink" title="hqlè¯­æ³•è¿›é˜¶ä¸å¸¸ç”¨å°æŠ€å·§"></a>hqlè¯­æ³•è¿›é˜¶ä¸å¸¸ç”¨å°æŠ€å·§</h2><h3 id="CTEæŸ¥è¯¢"><a href="#CTEæŸ¥è¯¢" class="headerlink" title="CTEæŸ¥è¯¢"></a>CTEæŸ¥è¯¢</h3><p>&amp;emsp;&amp;emsp;é€šè¿‡aså°†æŸ¥è¯¢è¯­å¥ä½œä¸ºä¸€ä¸ªä¸´æ—¶å­˜å‚¨è¡¨ç»™åè¾¹çš„æŸ¥è¯¢ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ä½ çš„sqlæ›´åŠ çµæ´»ç®€æ´ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs hiveql">WITH <br>t1 as (select * from t1 where name = &#x27;1&#x27;),<br>t2 as (select * from t2 where name = &#x27;2&#x27;)<br>select * from t1 join t2 on t1.id = t2.id<br></code></pre></td></tr></table></figure><h3 id="åˆ—åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼"><a href="#åˆ—åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="åˆ—åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼"></a>åˆ—åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼</h3><p>&amp;emsp;&amp;emsp;ä¸€ä¸ªè¡¨ä¸€åƒå¤šä¸ªåˆ—ç—›è‹¦ä¸ç—›è‹¦ï¼Ÿé€šè¿‡è®¾ç½®  SET hive.support.quoted.identifiers &#x3D; noneï¼›å¯ä»¥è¾“å‡ºæ­£åˆ™åŒ¹é…åˆ°çš„åˆ—å¹¶æ’é™¤ä¸€äº›ä¸éœ€è¦çš„åˆ—ã€‚</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> <span class="hljs-symbol">`^o.*`</span> <span class="hljs-keyword">from</span> table_name;<br></code></pre></td></tr></table></figure><h3 id="å¤šè¡¨æ’å…¥"><a href="#å¤šè¡¨æ’å…¥" class="headerlink" title="å¤šè¡¨æ’å…¥"></a>å¤šè¡¨æ’å…¥</h3><p>&amp;emsp;&amp;emsp;æœ‰æ—¶å€™æˆ‘ä»¬ä¼šé‡åˆ°ä¸åŒçš„æŸ¥è¯¢æ¡ä»¶æˆ–è€…éœ€è¦å°†ä¸€ä¸ªå¤§è¡¨ä¸­çš„æ•°æ®æ‹†åˆ†åˆ°ä¸åŒçš„æ•°æ®è¡¨ä¸­ï¼Œå¦‚æœæ¯ä¸ªæ•°æ®è¡¨å†™ä¸€ä¸ªsqlä¼šé€ æˆèµ„æºæµªè´¹æ•ˆç‡ä¹Ÿæ¯”è¾ƒä½ï¼Œ<br>è¿™æ—¶å€™fromè¯­æ³•å°±æ¥äº†ï¼Œå¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs hiveql">from table_name<br>insert overwrite table table1 where id &gt; 100<br>insert overwrite table table2 where name = &#x27;lee&#x27;<br></code></pre></td></tr></table></figure><blockquote><p>å¯ä»¥ä¸€æ¬¡è¯»å–table_nameè¡¨æ•°æ®æ’å…¥ä¸åŒè¡¨ä¸­</p></blockquote><h3 id="cube-rollup"><a href="#cube-rollup" class="headerlink" title="cube rollup"></a>cube rollup</h3><p>&amp;emsp;&amp;emsp;å¾ˆå¤šæ—¶å€™æˆ‘ä»¬é™¤äº†éœ€è¦åœ¨æŠ¥è¡¨ä¸­ç½—åˆ—å‡ºæ¯ä¸ªå…·ä½“é¡¹çš„æ•°æ®ï¼Œè¿˜éœ€è¦è¿›è¡Œæ±‡æ€»ï¼Œå¹¶ä¸”æ˜¯ä¸åŒç»´åº¦çš„æ±‡æ€»ã€‚å¦‚æœåœ¨å±•ç¤ºè¡¨æ ¼çš„æ—¶å€™æ±‡æ€»ï¼Œå¯èƒ½ä¼šæ¯”è¾ƒæ…¢ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯æŠŠç»“æœè®¡ç®—å‡ºæ¥ä¹‹åï¼Œä»¥â€™ALLâ€™æˆ–è€…â€™æ€»è®¡â€™,â€™æ±‡æ€»â€™ç­‰å­—æ ·ä½œä¸ºé¡¹çš„åç§°ï¼Œç„¶åæ”¾å…¥æ±‡æ€»å€¼ã€‚å¦‚æœä»…ä»…æ˜¯æ‰€æœ‰è¡Œçš„æ±‡æ€»ï¼Œä¸€æ¬¡èšåˆå°±æå®šã€‚ä½†æ˜¯ä¸åŒç»´åº¦çš„æ±‡æ€»å°±ä¼šå¾ˆéº»çƒ¦,è¿™æ—¶å€™å°±è½®åˆ°cube rollupå‡ºåœºäº†ã€‚</p><h4 id="cubeå‡½æ•°"><a href="#cubeå‡½æ•°" class="headerlink" title="cubeå‡½æ•°"></a>cubeå‡½æ•°</h4><p>&amp;emsp;&amp;emsp;cube(a,b,c)åˆ™é¦–å…ˆä¼šå¯¹(a,b,c)è¿›è¡Œgroup byï¼Œç„¶åä¾æ¬¡æ˜¯(a,b),(a,c),(a),(b,c),(b),(c),æœ€ååœ¨å¯¹å…¨è¡¨è¿›è¡Œgroup byï¼Œä»–ä¼šç»Ÿè®¡æ‰€é€‰åˆ—ä¸­å€¼çš„æ‰€æœ‰ç»„åˆçš„èšåˆï¼Œç”¨cubeå‡½æ•°å°±å¯ä»¥å®Œæˆæ‰€æœ‰ç»´åº¦çš„èšåˆå·¥ä½œã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs hiveql">select a,b,c from table_name group by a,b,c with cube<br></code></pre></td></tr></table></figure><blockquote><p>å¦‚æœæˆ‘ä»¬æƒ³è¦æ‰‹åŠ¨å®ç°cubeå‡½æ•°éœ€è¦æŠŠæ‰€æœ‰ç»´åº¦çš„èšåˆéƒ½ç”¨union allæ¥æ±‡æ€».<br>å¯ä»¥è¯´cubeå‡½æ•°æ–¹ä¾¿äº†ç”¨æˆ·çš„ä½¿ç”¨.<br>ä½†æ˜¯æˆ‘å¹¶ä¸ç”¨çŸ¥é“æ‰€æœ‰ç»´åº¦çš„èšåˆ,æˆ‘å°±æƒ³è¦col1,(col2,col3)çš„æ€ä¹ˆåŠ?</p></blockquote><p>grouping sets</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs hiveql">select a,b,c from table_name group by a,b,c grouping sets(a,(b,c)); <br></code></pre></td></tr></table></figure><h4 id="rollup"><a href="#rollup" class="headerlink" title="rollup"></a>rollup</h4><p>&amp;emsp;&amp;emsp;rullupå‡½æ•°æ˜¯cubeçš„å­é›†,ä»¥æœ€å·¦ä¾§ç»´åº¦ä¸ºä¸»,æŒ‰ç…§é¡ºåºä¾æ¬¡è¿›è¡Œèšåˆ.<br>ä¾‹å¦‚èšåˆçš„ç»´åº¦ä¸º col1,col2,col3 ä½¿ç”¨rollupèšåˆçš„å­—æ®µåˆ†åˆ«ä¸º col1,(col1,col2),(col1,col3),(col1,col2,col3)ã€‚    </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs hiveql">select a,b,c from table_name group by a,b,c with rollup;<br></code></pre></td></tr></table></figure><h3 id="è¡Œè½¬åˆ—"><a href="#è¡Œè½¬åˆ—" class="headerlink" title="è¡Œè½¬åˆ—"></a>è¡Œè½¬åˆ—</h3><p>&amp;emsp;&amp;emsp;æåˆ°è¡Œè½¬åˆ—ç›¸ä¿¡å¤§å®¶é¦–å…ˆæƒ³åˆ°çš„æ˜¯explodeï¼Œé…åˆlateral viewå¯ä»¥å®ç°ä¸€è¡Œå˜å¤šè¡Œã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs hiveql">select a, b, c from table_name t lateral view explode(t.e)  as c;<br>--å¯ä»¥é…åˆsplitä½¿ç”¨<br>select a, b, c from table_name t lateral view explode(split(t.e,&#x27;,&#x27;))  as c;<br>--å¯ä»¥é…åˆjson<br></code></pre></td></tr></table></figure><p>&amp;emsp;&amp;emsp;å¦å¤–lateral view è¿˜å¯ä»¥é…ç½®json_tupleä½¿ç”¨ï¼ŒæŠ½å–jsonçš„å¤šä¸ªå­—æ®µã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs hiveql">SELECT <br>    *<br>from<br>(select  *  from  table_name ) t1<br>lateral view json_tuple(json_field,&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;) state_json as a,b,c<br></code></pre></td></tr></table></figure><blockquote><p>è¿™æ ·ä¼šæŠŠjsoné‡Œé¢çš„ä¸‰ä¸ªvalueåŠ è½½åˆ°å·²æœ‰å­—æ®µå</p></blockquote><p>&amp;emsp;&amp;emsp;è¡Œè½¬åˆ—å¯¹åº”hiveé‡Œé¢çš„udtfï¼Œå¦‚æœç°æœ‰çš„å‡½æ•°æ»¡è¶³ä¸äº†ä½ çš„éœ€æ±‚ï¼Œå¯ä»¥å¼€å‘ä¸€ä¸ªudtfæ¥å®ç°è‡ªå®šä¹‰çš„è¡Œè½¬åˆ—æ“ä½œã€‚</p><h3 id="åˆ—è½¬è¡Œ"><a href="#åˆ—è½¬è¡Œ" class="headerlink" title="åˆ—è½¬è¡Œ"></a>åˆ—è½¬è¡Œ</h3><p>&amp;emsp;&amp;emsp;å¤šè¡Œå˜æˆä¸€è¡Œï¼Œå…¶å®å°±æ˜¯èšåˆæ“ä½œï¼Œé€šè¿‡group byæ“ä½œå¯ä»¥å®ç°èšåˆæ“ä½œï¼Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦æŠŠå­—æ®µä¿¡æ¯ä¹Ÿä¿ç•™ä¸‹æ¥ï¼Œè¿™æ—¶å€™å°±ç”¨åˆ°äº†collect_wsã€collect_setã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs hiveql">--æ ¹æ®a b èšåˆï¼Œå¯¹cå»é‡<br>select a,b,collect_set(c) from table_name group by a,b;<br>--æ ¹æ®a b èšåˆï¼Œç„¶åæŠŠcæ”¾åˆ°ä¸€ä¸ªæ•°æ®<br>select a,b,collect_list(c) from table_name group by a,b;<br>--æ ¹æ®a b èšåˆï¼Œç„¶åä½¿ç”¨ï¼Œæ‹¼æ¥cå­—æ®µ<br>select a,b,concat_ws(&quot;,&quot;,collect_list(c)) from table_name group by a,b;<br></code></pre></td></tr></table></figure><h3 id="çª—å£å‡½æ•°"><a href="#çª—å£å‡½æ•°" class="headerlink" title="çª—å£å‡½æ•°"></a>çª—å£å‡½æ•°</h3><p>&amp;emsp;&amp;emsp;çª—å£å‡½æ•°æ˜¯ç”¨äºåˆ†æçš„ä¸€ç±»å‡½æ•°ï¼Œè¦ç†è§£çª—å£å‡½æ•°è¦å…ˆä»èšåˆå‡½æ•°è¯´èµ·ã€‚ å¤§å®¶éƒ½çŸ¥é“èšåˆå‡½æ•°æ˜¯å°†æŸåˆ—ä¸­å¤šè¡Œçš„å€¼åˆå¹¶ä¸ºä¸€è¡Œï¼Œæ¯”å¦‚sumã€countç­‰ã€‚ è€Œçª—å£å‡½æ•°åˆ™å¯ä»¥åœ¨æœ¬è¡Œå†…åšè¿ç®—ï¼Œå¾—åˆ°å¤šè¡Œçš„ç»“æœï¼Œå³æ¯ä¸€è¡Œå¯¹åº”ä¸€è¡Œçš„å€¼ã€‚ é€šç”¨çš„çª—å£å‡½æ•°å¯ä»¥ç”¨ä¸‹é¢çš„è¯­æ³•æ¥æ¦‚æ‹¬ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs hiveql">Function() Over (Partition By Column1,Column2,Order By Column3);<br></code></pre></td></tr></table></figure><p>&amp;emsp;&amp;emsp;çª—å£å‡½æ•°åˆ†ä¸‰ç±»ï¼šèšåˆå‹çª—å£å‡½æ•°ã€åˆ†æå‹çª—å£å‡½æ•°ã€å–å€¼å‹çª—å£å‡½æ•°</p><h4 id="èšåˆå‹"><a href="#èšåˆå‹" class="headerlink" title="èšåˆå‹"></a>èšåˆå‹</h4><p>&amp;emsp;&amp;emsp;èšåˆå‹å³SUM(),MIN(),MAX(),AVG(),COUNT()è¿™äº›å¸¸è§çš„èšåˆå‡½æ•°ã€‚ èšåˆå‡½æ•°é…åˆçª—å£å‡½æ•°ä½¿ç”¨å¯ä»¥ä½¿è®¡ç®—æ›´åŠ çµæ´»ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs hiveql">select *,sum/count/max/min/avg(file_name) over(partition by file_name order by field_name) from table_name<br></code></pre></td></tr></table></figure><h4 id="åˆ†æå‹"><a href="#åˆ†æå‹" class="headerlink" title="åˆ†æå‹"></a>åˆ†æå‹</h4><p>&amp;emsp;&amp;emsp;åˆ†æå‹å³RANk(),ROW_NUMBER(),DENSE_RANK()ç­‰å¸¸è§çš„æ’åºç”¨çš„çª—å£å‡½æ•°ï¼Œä¸è¿‡ä»–ä»¬ä¹Ÿæ˜¯æœ‰åŒºåˆ«çš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs hiveql">select *,<br>--ä¿©ä¸ªå…ƒç´ ç›¸åŒä¼šè·³è¿‡ä¸‹ä¸€ä¸ªåºåˆ—å·<br>rank() over (order by create_time) as user_rank,<br>--ç”Ÿæˆè¿ç»­çš„åºåˆ—å·<br>row_number() over (order by create_time) as user_row_number,<br>--ä¿©ä¸ªå…ƒç´ ç›¸åŒä¸ä¼šè·³è¿‡ä¸‹ä¸€ä¸ªåºåˆ—å·<br>dense_rank() over (order by create_time) as user_dense_rank<br>from table_name<br></code></pre></td></tr></table></figure><h4 id="å–å€¼å‹"><a href="#å–å€¼å‹" class="headerlink" title="å–å€¼å‹"></a>å–å€¼å‹</h4><p>&amp;emsp;&amp;emsp;è¿™å‡ ä¸ªå‡½æ•°å¯ä»¥é€šè¿‡å­—é¢æ„æ€å¯çŸ¥ï¼ŒLAGæ˜¯è¿Ÿæ»çš„æ„æ€ï¼Œç”¨äºç»Ÿè®¡çª—å£å†…å¾€ä¸Šç¬¬nè¡Œå€¼ï¼›LEADæ˜¯LAGçš„åä¹‰è¯ï¼Œç”¨äºç»Ÿè®¡çª—å£å†…å¾€ä¸‹ç¬¬nè¡Œå€¼ï¼›FIRST_VALUEæ˜¯è¯¥åˆ—åˆ°ç›®å‰ä¸ºæ­¢çš„é¦–ä¸ªå€¼ï¼Œè€ŒLAST_VALUEæ˜¯åˆ°ç›®å‰è¡Œä¸ºæ­¢çš„æœ€åä¸€ä¸ªå€¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs hiveql">--ä»¥è´·æ¬¾ä¸ºä¾‹<br>SELECT *,<br>--å–ä¸Šä¸€ç¬”è´·æ¬¾çš„æ—¥æœŸ,ç¼ºå¤±é»˜è®¤å¡«NULL<br>LAG(orderdate, 1) OVER(PARTITION BY name ORDER BY orderdate) AS last_dt,<br>--å–ä¸‹ä¸€ç¬”è´·æ¬¾çš„æ—¥æœŸ,ç¼ºå¤±æŒ‡å®šå¡«&#x27;1970-1-1&#x27;<br>LEAD(orderdate, 1,&#x27;1970-1-1&#x27;) OVER(PARTITION BY name ORDER BY orderdate) AS next_dt,<br>--å»ç¬¬ä¸€ä¸ªçš„æ—¥æœŸ<br>FIRST_VALUE(orderdate) OVER(PARTITION BY name ORDER BY orderdate) AS first_dt,<br>--å–æœ€åä¸€ä¸ªæ—¥æœŸ<br>LAST_VALUE(orderdate) OVER(PARTITION BY name ORDER BY orderdate) AS latest_dt<br>from table_name<br></code></pre></td></tr></table></figure><h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æœ¬æ–‡ä¸»è¦åˆ†äº«äº†hiveçš„ä¼˜åŒ–å™¨å’ŒSQLä½¿ç”¨æŠ€å·§ã€‚æœ€åï¼Œä¸ç®¡ä½ æ˜¯SQL boy or  SQL girlï¼Œåªè¦æŒæ¡ä¸€äº›æŠ€å·§ï¼Œç›¸ä¿¡éƒ½èƒ½å¤ŸHappy SQL querying ğŸ˜Šã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>hive-mapjoinæ¢ç´¢</title>
    <link href="/2022/03/02/hive-mapjoin%E6%8E%A2%E7%B4%A2/"/>
    <url>/2022/03/02/hive-mapjoin%E6%8E%A2%E7%B4%A2/</url>
    
    <content type="html"><![CDATA[<h1 id="è®©ä½ çœŸæ­£äº†è§£mapjoinå‚æ•°"><a href="#è®©ä½ çœŸæ­£äº†è§£mapjoinå‚æ•°" class="headerlink" title="è®©ä½ çœŸæ­£äº†è§£mapjoinå‚æ•°"></a>è®©ä½ çœŸæ­£äº†è§£mapjoinå‚æ•°</h1><p>é¦–å…ˆåˆ›å»ºå¥½small_tableå’Œbig_tableä¿©ä¸ªè¡¨ã€‚ç›´æ¥ç»™ä¿©ä¸ªè¡¨æ‰§è¡Œjoinã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><pre><code class="hljs hiveql">set hive.cbo.enable=false;<br>set hive.auto.convert.join=false; <br>set hive.auto.convert.join.noconditionaltask=false; <br>explain select t1.* from small_table t1 join big_table t2 on t1.id = t2.id;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥åˆ†ææ‰§è¡Œè®¡åˆ’ï¼Œä¸€å…±ä¿©ä¸ªstageï¼Œç¬¬ä¸€ä¸ªstageæ˜¯joinï¼Œç¬¬äºŒä¸ªæ˜¯è¿›è¡Œfetchæ•°æ®</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">STAGE</span> DEPENDENCIES:<br>  <span class="hljs-attribute">Stage</span>-<span class="hljs-number">1</span> is a root stage<br>  <span class="hljs-attribute">Stage</span>-<span class="hljs-number">0</span> depends <span class="hljs-literal">on</span> stages: Stage-<span class="hljs-number">1</span> å…¶å®stage0å°±æ˜¯fetchç®—å­ï¼ŒæŠŠç»“æœæ‹‰åˆ°clientç«¯<br></code></pre></td></tr></table></figure><p>åˆ†æstage-0,çœ‹fetchæ•°æ®å°±æ˜¯fetch operator</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">Stage</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Stage-0</span><br>  <span class="hljs-attribute">Fetch Operator</span><br><span class="hljs-attribute">    limit</span><span class="hljs-punctuation">:</span> <span class="hljs-string">-1 ä»£è¡¨æ‰€æœ‰</span><br>    <span class="hljs-attribute">Processor Tree</span><span class="hljs-punctuation">:</span><br>      ListSink <br></code></pre></td></tr></table></figure><p>åˆ†æä¸»è¦çš„é˜¶æ®µstage-1ï¼Œè¿™ä¸ªé˜¶æ®µscanä¿©ä¸ªè¡¨çš„æ•°æ®ï¼ŒåŒæ—¶æŠ½å–join keyè¿›è¡Œäº†reduceæ“ä½œã€‚</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs arcade">STAGE PLANS:<br>  Stage: Stage<span class="hljs-number">-1</span><br>    <span class="hljs-built_in">Map</span> <span class="hljs-built_in">Reduce</span>  ä»£è¡¨è¿™ä¸ªstageå°±æ˜¯ä¸€ä¸ªmapreduceä»»åŠ¡<br>      <span class="hljs-built_in">Map</span> Operator Tree:  è¿™ä¸ªä»£è¡¨<span class="hljs-built_in">map</span>ç®—å­çš„é˜¶æ®µï¼Œ<span class="hljs-built_in">map</span>é’ˆå¯¹ä¸Šé¢sqlå…¶å®å°±æ˜¯å¯¹ä¿©ä¸ªè¡¨è¿›è¡Œscanï¼ŒåŒæ—¶å–å¯¹åº”å¯¹å­—æ®µ<br>      <span class="hljs-built_in">Reduce</span> Operator Tree:  è¿™ä¸ªä»£è¡¨<span class="hljs-built_in">reduce</span>ç®—å­çš„é˜¶æ®µï¼Œé’ˆå¯¹joinå¯¹å­—æ®µè¿›è¡Œèšåˆ<br></code></pre></td></tr></table></figure><p>å…ˆçœ‹ä¸‹Map Operator Treeï¼Œéœ€è¦æ³¨æ„çš„æ˜¯joinä¼šè‡ªåŠ¨æŠŠjoinå­—æ®µçš„nullå»æ‰ã€‚ id is not nullï¼Œçœ‹TableScan t1å’ŒTableScan t2åŒºåˆ«å°±æ˜¯ç¬¬ä¸€ä¸ªæ˜¯æœ‰ä¸ªvalueè¡¨è¾¾å¼ï¼Œå› ä¸ºselectåªselectäº†t1è¡¨çš„å­—æ®µï¼Œå…¶ä»–æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œéƒ½æ˜¯æ‰«æè¡¨çš„æ•°æ®ã€‚</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs lasso"><span class="hljs-built_in">Map</span> Operator Tree:<br>          TableScan<br>            alias: t1<br>            Statistics: Num <span class="hljs-keyword">rows</span>: <span class="hljs-number">94</span> <span class="hljs-built_in">Data</span> size: <span class="hljs-number">10222</span> Basic stats: COMPLETE Column stats: <span class="hljs-literal">NONE</span><br>            Filter Operator<br>              predicate: id is <span class="hljs-literal">not</span> <span class="hljs-built_in">null</span> (<span class="hljs-keyword">type</span>: <span class="hljs-built_in">boolean</span>)<br>              Statistics: Num <span class="hljs-keyword">rows</span>: <span class="hljs-number">94</span> <span class="hljs-built_in">Data</span> size: <span class="hljs-number">10222</span> Basic stats: COMPLETE Column stats: <span class="hljs-literal">NONE</span><br>              Reduce Output Operator<br>                key expressions: id (<span class="hljs-keyword">type</span>: int)<br>                sort <span class="hljs-keyword">order</span>: +<br>                <span class="hljs-built_in">Map</span><span class="hljs-params">-reduce</span> partition columns: id (<span class="hljs-keyword">type</span>: int)<br>                Statistics: Num <span class="hljs-keyword">rows</span>: <span class="hljs-number">94</span> <span class="hljs-built_in">Data</span> size: <span class="hljs-number">10222</span> Basic stats: COMPLETE Column stats: <span class="hljs-literal">NONE</span><br>                value expressions: name (<span class="hljs-keyword">type</span>: <span class="hljs-built_in">string</span>),<span class="hljs-params">...</span>f7 (<span class="hljs-keyword">type</span>: <span class="hljs-built_in">string</span>)<br>          TableScan<br>            alias: t2<br>            Statistics: Num <span class="hljs-keyword">rows</span>: <span class="hljs-number">9552</span> <span class="hljs-built_in">Data</span> size: <span class="hljs-number">1039073</span> Basic stats: COMPLETE Column stats: <span class="hljs-literal">NONE</span><br>            Filter Operator<br>              predicate: id is <span class="hljs-literal">not</span> <span class="hljs-built_in">null</span> (<span class="hljs-keyword">type</span>: <span class="hljs-built_in">boolean</span>)<br>              Statistics: Num <span class="hljs-keyword">rows</span>: <span class="hljs-number">9552</span> <span class="hljs-built_in">Data</span> size: <span class="hljs-number">1039073</span> Basic stats: COMPLETE Column stats: <span class="hljs-literal">NONE</span><br>              Reduce Output Operator<br>                key expressions: id (<span class="hljs-keyword">type</span>: int)<br>                sort <span class="hljs-keyword">order</span>: +<br>                <span class="hljs-built_in">Map</span><span class="hljs-params">-reduce</span> partition columns: id (<span class="hljs-keyword">type</span>: int)<br>                Statistics: Num <span class="hljs-keyword">rows</span>: <span class="hljs-number">9552</span> <span class="hljs-built_in">Data</span> size: <span class="hljs-number">1039073</span> Basic stats: COMPLETE Column stats: <span class="hljs-literal">NONE</span><br></code></pre></td></tr></table></figure><p>æœ€åå°±æ˜¯reduceé˜¶æ®µ</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sqf">Reduce Operator Tree:<br>  <span class="hljs-built_in">Join</span> Operator<br>    condition map:<br>         Inner <span class="hljs-built_in">Join</span> <span class="hljs-number">0</span> <span class="hljs-keyword">to</span> <span class="hljs-number">1</span><br>    <span class="hljs-built_in">keys</span>:<br>      <span class="hljs-number">0</span> id (<span class="hljs-built_in">type</span>: int)<br>      <span class="hljs-number">1</span> id (<span class="hljs-built_in">type</span>: int)<br>    outputColumnNames: <span class="hljs-variable">_col0</span>, <span class="hljs-variable">_col1</span>, <span class="hljs-variable">_col2</span>, <span class="hljs-variable">_col3</span>, <span class="hljs-variable">_col4</span>, <span class="hljs-variable">_col5</span>, <span class="hljs-variable">_col6</span>, <span class="hljs-variable">_col7</span>, <span class="hljs-variable">_col8</span>, <span class="hljs-variable">_col9</span>, <span class="hljs-variable">_col10</span><br>    Statistics: Num rows: <span class="hljs-number">10507</span> Data <span class="hljs-built_in">size</span>: <span class="hljs-number">1142980</span> Basic stats: COMPLETE Column stats: NONE<br>    File Output Operator<br>      compressed: <span class="hljs-literal">false</span><br>      Statistics: Num rows: <span class="hljs-number">10507</span> Data <span class="hljs-built_in">size</span>: <span class="hljs-number">1142980</span> Basic stats: COMPLETE Column stats: NONE<br>      table:<br>          input <span class="hljs-built_in">format</span>: org.apache.hadoop.mapred.SequenceFileInputFormat<br>          output <span class="hljs-built_in">format</span>: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat<br>          serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe<br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šå°±æ˜¯æ²¡æœ‰å¼€å§‹mapjoinï¼Œè®©æˆ‘ä»¬æŠŠmapjoinæ‰“å¼€è¯•ä¸€è¯•ï¼Œå°è¡¨çš„å¤§å°æ˜¯10Mã€‚æµ‹è¯•ä¸€ä¸‹å¼€å¯mapjoinã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs hiveql">set hive.cbo.enable=false;<br>set hive.auto.convert.join=false;<br>set hive.auto.convert.join.noconditionaltask=false;<br>set hive.auto.convert.join=true;<br>explain select t1.* from small_table t1 join big_table t2 on t1.id = t2.id;<br></code></pre></td></tr></table></figure><p>å…ˆåˆ†æä¸€ä¸‹stageä¹‹é—´çš„ä¾èµ–</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">STAGE</span> DEPENDENCIES:<br>  <span class="hljs-attribute">Stage</span>-<span class="hljs-number">4</span> is a root stage , consists of Stage-<span class="hljs-number">5</span>, Stage-<span class="hljs-number">1</span><br>  <span class="hljs-attribute">Stage</span>-<span class="hljs-number">5</span> has a backup stage: Stage-<span class="hljs-number">1</span><br>  <span class="hljs-attribute">Stage</span>-<span class="hljs-number">3</span> depends <span class="hljs-literal">on</span> stages: Stage-<span class="hljs-number">5</span><br>  <span class="hljs-attribute">Stage</span>-<span class="hljs-number">1</span><br>  <span class="hljs-attribute">Stage</span>-<span class="hljs-number">0</span> depends <span class="hljs-literal">on</span> stages: Stage-<span class="hljs-number">3</span>, Stage-<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>é¦–å…ˆçœ‹stage4ï¼Œè¿™ä¸ªstageæ˜¯rootï¼Œä¹Ÿå°±æ˜¯æœ€é¡¶éƒ¨çš„ï¼Œstage Conditional Operatorè¿™æ˜¯ä¸€ä¸ªæ¡ä»¶è¿ç®—ç¬¦ï¼ŒåŒ…æ‹¬5å’Œ1ã€‚è¿™å¿«çœ‹ä¸å¤ªæ‡‚ä»€ä¹ˆæ„æ€ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹çœ‹stage-1è¿™ä¸ªåè¾¹æ²¡æœ‰ä»»ä½•ä¾èµ–ã€‚</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs lasso">Stage: Stage<span class="hljs-number">-1</span><br>    <span class="hljs-built_in">Map</span> Reduce<br>      <span class="hljs-built_in">Map</span> Operator Tree:<br>          TableScan<br>          TableScan<br>      Reduce Operator Tree:<br>        <span class="hljs-keyword">Join</span> Operator<br>          condition <span class="hljs-built_in">map</span>:<br>               Inner <span class="hljs-keyword">Join</span> <span class="hljs-number">0</span> <span class="hljs-keyword">to</span> <span class="hljs-number">1</span><br>          keys:<br>            <span class="hljs-number">0</span> id (<span class="hljs-keyword">type</span>: int)<br>            <span class="hljs-number">1</span> id (<span class="hljs-keyword">type</span>: int)<br></code></pre></td></tr></table></figure><p>stage-1å¯ä»¥çœ‹å‡ºæ¥ï¼Œè·Ÿä¸å¼€å¯mapjoinæ˜¯ä¸€æ‘¸ä¸€æ ·çš„ï¼Œå¯èƒ½è¿™ä¸ªä¸»è¦æ˜¯ç°å®æœ€åˆçš„æ‰§è¡Œè®¡åˆ’çš„ã€‚æ²¡æœ‰å¤ªå¤šç”¨å¤„ï¼Œå³è¯¶å•Šæ¥çœ‹ä¸‹stage-0è¿™ä¸ªä¸»è¦æ˜¯ä»£è¡¨æˆ‘ä»¬fetchæ•°æ®çš„ç®—å­ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯æ‹‰å–ç»“æœçš„</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">Stage</span><span class="hljs-punctuation">:</span> <span class="hljs-string">Stage-0</span><br>    <span class="hljs-attribute">Fetch Operator</span><br><span class="hljs-attribute">      limit</span><span class="hljs-punctuation">:</span> <span class="hljs-string">-1</span><br>      <span class="hljs-attribute">Processor Tree</span><span class="hljs-punctuation">:</span><br>        ListSink<br></code></pre></td></tr></table></figure><p>è·ŸåŸæ¥çš„ä¸€æ ·ï¼Œè¿™ä¸ªstage-0ä¾èµ–äº3ã€1ï¼Œ1æˆ‘ä»¬å·²ç»çœ‹è¿‡äº†ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹3</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs lasso">Stage: Stage<span class="hljs-number">-3</span><br>    <span class="hljs-built_in">Map</span> Reduce<br>      <span class="hljs-built_in">Map</span> Operator Tree:<br>          TableScan<br>            alias: t2<br>            Statistics: Num <span class="hljs-keyword">rows</span>: <span class="hljs-number">955184</span> <span class="hljs-built_in">Data</span> size: <span class="hljs-number">103902452</span> Basic stats: COMPLETE Column stats: <span class="hljs-literal">NONE</span><br>            Filter Operator<br>              predicate: id is <span class="hljs-literal">not</span> <span class="hljs-built_in">null</span> (<span class="hljs-keyword">type</span>: <span class="hljs-built_in">boolean</span>)<br>              Statistics: Num <span class="hljs-keyword">rows</span>: <span class="hljs-number">955184</span> <span class="hljs-built_in">Data</span> size: <span class="hljs-number">103902452</span> Basic stats: COMPLETE Column stats: <span class="hljs-literal">NONE</span><br>              <span class="hljs-built_in">Map</span> <span class="hljs-keyword">Join</span> Operator<br>                condition <span class="hljs-built_in">map</span>:<br>                     Inner <span class="hljs-keyword">Join</span> <span class="hljs-number">0</span> <span class="hljs-keyword">to</span> <span class="hljs-number">1</span><br>                keys:<br>                  <span class="hljs-number">0</span> id (<span class="hljs-keyword">type</span>: int)<br>                  <span class="hljs-number">1</span> id (<span class="hljs-keyword">type</span>: int)<br>                outputColumnNames: _col0, _col1, _col2, _col3, _col4, _col5, _col6, _col7, _col8, _col9, _col10<br>                Statistics: Num <span class="hljs-keyword">rows</span>: <span class="hljs-number">1050702</span> <span class="hljs-built_in">Data</span> size: <span class="hljs-number">114292699</span> Basic stats: COMPLETE Column stats: <span class="hljs-literal">NONE</span><br>                File Output Operator<br>                  compressed: <span class="hljs-literal">false</span><br>                  Statistics: Num <span class="hljs-keyword">rows</span>: <span class="hljs-number">1050702</span> <span class="hljs-built_in">Data</span> size: <span class="hljs-number">114292699</span> Basic stats: COMPLETE Column stats: <span class="hljs-literal">NONE</span><br>                  table:<br>                      input format: org.apache.hadoop.mapred.SequenceFileInputFormat<br>                      output format: org.apache.hadoop.hive.ql.io.HiveSequenceFileOutputFormat<br>                      serde: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe<br>      <span class="hljs-built_in">Local</span> Work:<br>        <span class="hljs-built_in">Map</span> Reduce <span class="hljs-built_in">Local</span> Work<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªé˜¶æ®µå°±æ˜¯å…³é”®ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸€ä¸ªmapreduceä»»åŠ¡ï¼Œä½†æ˜¯æ²¡æœ‰Reduce Operatorï¼Œä½¿ç”¨ä¸€ä¸ªlocal workæ›¿ä»£äº†ï¼Œè€Œä¸”joinçš„æ¡ä»¶éƒ½æ”¾åœ¨äº†Map Operatoré‡Œé¢äº†ï¼Œæ‰€ä»¥è¿™ä¸ªå°±æ˜¯mapjoinçš„çœŸæ­£é€»è¾‘ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹local workï¼Œå› ä¸ºstage-3ä¾èµ–äºstage-5ï¼Œæ¥ä¸‹æ¥çœ‹stage-5</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs lasso">Stage: Stage<span class="hljs-number">-5</span><br>   <span class="hljs-built_in">Map</span> Reduce <span class="hljs-built_in">Local</span> Work<br>     Alias -&gt; <span class="hljs-built_in">Map</span> <span class="hljs-built_in">Local</span> Tables:<br>       t1<br>         Fetch Operator<br>           limit: <span class="hljs-number">-1</span><br>     Alias -&gt; <span class="hljs-built_in">Map</span> <span class="hljs-built_in">Local</span> Operator Tree:<br>       t1<br>         TableScan<br>           alias: t1<br>           Statistics: Num <span class="hljs-keyword">rows</span>: <span class="hljs-number">95521</span> <span class="hljs-built_in">Data</span> size: <span class="hljs-number">10390248</span> Basic stats: COMPLETE Column stats: <span class="hljs-literal">NONE</span><br>           Filter Operator<br>             predicate: id is <span class="hljs-literal">not</span> <span class="hljs-built_in">null</span> (<span class="hljs-keyword">type</span>: <span class="hljs-built_in">boolean</span>)<br>             Statistics: Num <span class="hljs-keyword">rows</span>: <span class="hljs-number">95521</span> <span class="hljs-built_in">Data</span> size: <span class="hljs-number">10390248</span> Basic stats: COMPLETE Column stats: <span class="hljs-literal">NONE</span><br>             HashTable Sink Operator<br>               keys:<br>                 <span class="hljs-number">0</span> id (<span class="hljs-keyword">type</span>: int)<br>                 <span class="hljs-number">1</span> id (<span class="hljs-keyword">type</span>: int)<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªä¸€ä¸ªmapreduceçš„æœ¬åœ°å·¥ä½œï¼Œè·Ÿstage-3é‡Œé¢çš„local workæ˜¯èƒ½å¯¹ä¸Šçš„ï¼Œè¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯æŠŠt1è¡¨é€šè¿‡æœ¬åœ°åŠ è½½ï¼Œæ¡ä»¶è·Ÿmapreduceé‡Œé¢çš„æ˜¯ä¸€æ ·çš„ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œä»¥åæˆ‘ä»¬æŸ¥çœ‹è¡¨çš„æ‰§è¡Œè®¡åˆ’å¯ä»¥å¾ˆå¿«çš„åˆ†æå‡ºæ¥ã€‚æ¥ä¸‹æ¥è®©æˆ‘ä»¬éªŒè¯ä¸‹çœ‹èµ·cboæ˜¯å¦å¯¹mapjoinæœ‰å½±å“ã€‚<br>é¦–å…ˆæˆ‘ä»¬å¯¹smallå°è¡¨ç›´æ¥æ’å…¥100Mæ•°æ®ï¼Œè¿™ä¸ªæ•°æ®é‡ä¸æ»¡è¶³äº†mapjoinå¯¹æ¡ä»¶ï¼Œé¦–å…ˆçœ‹å…³é—­CBO</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">set</span> hive.cbo.<span class="hljs-attribute">enable</span>=<span class="hljs-literal">false</span>;<br><span class="hljs-built_in">set</span> hive.auto.convert.<span class="hljs-attribute">join</span>=<span class="hljs-literal">false</span>;<br><span class="hljs-built_in">set</span> hive.auto.convert.join.<span class="hljs-attribute">noconditionaltask</span>=<span class="hljs-literal">false</span>;<br><span class="hljs-built_in">set</span> hive.auto.convert.<span class="hljs-attribute">join</span>=<span class="hljs-literal">true</span>;<br>explain select t1.* <span class="hljs-keyword">from</span> small_table t1 join big_table t2 on t1.id = t2.id;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªç»“æœè·Ÿä¸å¼€å¯mapjoinæ˜¯ä¸€è‡´å¯¹ï¼Œå› ä¸ºä¿©ä¸ªè¡¨å¯¹å¤§å°éƒ½è¶…è¿‡äº†æˆ‘ä»¬è®¾å®šéƒ½é˜ˆå€¼ã€‚è¿™è¾¹å¯ä»¥åˆ¤æ–­cdpè¯»å–hiveçš„å…ƒæ•°æ®æ²¡æœ‰å½±å“mapjoinçš„æ‰§è¡Œï¼Œå› ä¸ºæˆ‘çœ‹åˆ°æœ‰çš„æ–‡ç« è¯´æœ‰æ—¶å€™å¼€å¯cboä»¥åmapjoinä¸ç”Ÿæ•ˆï¼ˆä¸è¿‡åˆ«äººçš„æ–‡ç« æ˜¯è¯´çš„ä½¿ç”¨tezæ‰§è¡Œå¼•æ“ï¼Œæ‰€ä»¥è¿™ç‚¹è¿˜æœ‰å¾…éªŒè¯ï¼‰</p><p>æˆ‘ä»¬æµ‹è¯•å¼€å¯cboï¼Œå¼€å¯cboæˆæœ¬åº”è¯¥æ˜¯ä»hiveéƒ½å…ƒæ•°æ®é‡Œé¢å–æ•°æ®éƒ½ï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬æ˜¯ç›´æ¥å¾€hdfsä¸Šé¢æ”¾éƒ½æ•°æ®ï¼Œå…ƒæ•°æ®smallè¡¨è¿˜æ˜¯10M</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">set</span> hive.cbo.<span class="hljs-attribute">enable</span>=<span class="hljs-literal">true</span>;<br><span class="hljs-built_in">set</span> hive.auto.convert.<span class="hljs-attribute">join</span>=<span class="hljs-literal">true</span>;<br><span class="hljs-built_in">set</span> hive.mapjoin.smalltable.<span class="hljs-attribute">filesize</span>=460000000;<br><span class="hljs-built_in">set</span> hive.auto.convert.join.<span class="hljs-attribute">noconditionaltask</span>=<span class="hljs-literal">true</span>;<br><span class="hljs-built_in">set</span> hive.auto.convert.join.noconditionaltask.<span class="hljs-attribute">size</span>=10000000; <br><span class="hljs-built_in">set</span> hive.auto.convert.<span class="hljs-attribute">join</span>=<span class="hljs-literal">true</span>;<br>explain select t1.* <span class="hljs-keyword">from</span> small_table t1 join big_table t2 on t1.id = t2.id;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>parquet.md</title>
    <link href="/2022/03/02/parquet-md/"/>
    <url>/2022/03/02/parquet-md/</url>
    
    <content type="html"><![CDATA[<h1 id="PARQUET"><a href="#PARQUET" class="headerlink" title="PARQUET"></a>PARQUET</h1><h2 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="headerlink" title="ä¼˜åŠ¿"></a>ä¼˜åŠ¿</h2><figure class="highlight node-repl"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><pre><code class="hljs node-repl">1ã€æ›´é«˜çš„å‹ç¼©æ¯”å¯ä»¥å‡å°‘ç£ç›˜çš„ä½¿ç”¨<br>2ã€æ›´å°‘çš„IOæ“ä½œä½¿ç”¨æ˜ å°„ä¸‹æ¨å’Œè°“è¯ä¸‹æ¨ï¼Œå¯ä»¥è¯»å–éœ€è¦çš„åˆ—ï¼Œè¿‡æ»¤æ‰ä¸éœ€è¦çš„åˆ—ï¼Œå‡å°‘ä¸å¿…è¦çš„æ•°æ®æ‰«æï¼Œå°¤å…¶å¯¹äºè¡¨å­—æ®µæ¯”è¾ƒå¤šçš„æ—¶å€™ä¼˜åŠ¿æ˜æ˜¾ã€‚<br><span class="hljs-meta">&gt;</span> <span class="language-javascript">æ˜ å°„ä¸‹æ¨ï¼šåˆ—å¼å­˜å‚¨æœ€çªå‡ºçš„ä¼˜åŠ¿ï¼Œæ•°æ®æ‰«æçš„æ—¶å€™ï¼Œåªéœ€è¦æ‰«æéœ€è¦çš„åˆ—ï¼Œé¿å…å…¨è¡¨æ‰«æ</span><br><span class="hljs-meta">&gt;</span> <span class="language-javascript">è°“è¯ä¸‹æ¨ï¼šå°†è¿‡æ»¤æ¡ä»¶åœ¨æœ€åº•å±‚æ‰§è¡Œå‡å°‘ç»“æœé›†</span><br></code></pre></td></tr></table></figure><h2 id="å¦‚ä½•æå‡parquetçš„æŸ¥è¯¢æ€§èƒ½"><a href="#å¦‚ä½•æå‡parquetçš„æŸ¥è¯¢æ€§èƒ½" class="headerlink" title="å¦‚ä½•æå‡parquetçš„æŸ¥è¯¢æ€§èƒ½"></a>å¦‚ä½•æå‡parquetçš„æŸ¥è¯¢æ€§èƒ½</h2><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-number">1</span>ã€å¯¹éœ€è¦é¢‘ç¹è¿‡æ»¤çš„åˆ—è®¾ç½®ä¸ºæœ‰åºçš„ï¼Œè¿™æ ·åœ¨å¯¼å…¥æ•°æ®çš„æ—¶å€™ä¼šæ ¹æ®è¯¥åˆ—çš„é¡ºåºå­˜å‚¨æ•°æ®ï¼Œè¿™æ ·å¯ä»¥æ›´å¥½çš„åˆ©ç”¨æœ€å¤§å€¼æœ€å°å€¼å®ç°è°“è¯ä¸‹æ¨<br><span class="hljs-number">2</span>ã€å‡å°‘è¡Œç»„å¤§å°å’Œé¡µå¤§å°ï¼Œè¿™æ ·å¢åŠ è·³è¿‡æ•´ä¸ªè¡Œç»„çš„å¯èƒ½æ€§ï¼Œä½†æ˜¯æ­¤æ—¶éœ€è¦æƒè¡¡ç”±äºå‹ç¼©å’Œç¼–ç æ•ˆç‡ä¸‹é™å¸¦æ¥çš„<span class="hljs-built_in">I</span><span class="hljs-operator">/</span><span class="hljs-built_in">O</span>è´Ÿè½½ã€‚<br></code></pre></td></tr></table></figure><h2 id="æ–‡ä»¶æ ¼å¼"><a href="#æ–‡ä»¶æ ¼å¼" class="headerlink" title="æ–‡ä»¶æ ¼å¼"></a>æ–‡ä»¶æ ¼å¼</h2><p>row group &gt; column chunk &gt; page</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs css">row groupè¡Œç»„ï¼šæ¯ä¸€ä¸ªè¡Œç»„åŒ…å«ä¸€å®šçš„è¡Œæ•°ï¼Œä¸€èˆ¬å¯¹åº”ä¸€ä¸ªHDFSæ–‡ä»¶å—ï¼ŒParquetè¯»å†™çš„æ—¶å€™ä¼šå°†æ•´ä¸ªè¡Œç»„ç¼“å­˜åœ¨å†…å­˜ä¸­<br>column chunkåˆ—å—ï¼šåœ¨ä¸€ä¸ªè¡Œç»„ä¸­ï¼Œæ¯ä¸€åˆ—ä¿å­˜åœ¨ä¸€ä¸ªåˆ—å—ä¸­ï¼Œä¸€ä¸ªåˆ—å—ä¸­çš„ç±»å‹éƒ½æ˜¯ç›¸åŒçš„ï¼Œä¸åŒç±»å‹çš„åˆ—å—å¯ä»¥ä½¿ç”¨ä¸åŒdçš„ç®—æ³•è¿›è¡Œå‹ç¼©ã€‚<br>pageé¡µï¼šæ¯ä¸€ä¸ªåˆ—å—è¢«åˆ’åˆ†æˆå¤šä¸ªé¡µï¼Œé¡µæ—¶æœ€å°çš„ç¼–ç å•ä½ï¼Œåœ¨åŒä¸€ä¸ªåˆ—å—çš„ä¸åŒé¡µå¯èƒ½ä½¿ç”¨ä¸åŒçš„ç¼–ç æ–¹å¼<br><br>ä¸€ä¸ªparquetæ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶å¤´å’Œæ–‡ä»¶å°¾éƒ½æ˜¯<span class="hljs-number">4</span>ä¸ªå­—èŠ‚çš„magic <span class="hljs-selector-tag">code</span>ï¼Œæ ¡éªŒæ˜¯å¦æ˜¯parquetæ–‡ä»¶ã€‚<br>ç„¶åå°¾éƒ¨magic <span class="hljs-selector-tag">code</span>ä¹‹å‰æ˜¯<span class="hljs-selector-tag">footer</span> lengthï¼Œæ˜¯æ–‡ä»¶å…ƒæ•°æ®çš„å¤§å°ï¼Œé€šè¿‡è¿™ä¸ªå¤§å°å°±å¯ä»¥è®¡ç®—å‡ºyå…ƒæ•°æ®<span class="hljs-selector-tag">footer</span>çš„åç§»é‡<br><span class="hljs-selector-tag">footer</span>ä¸­åŒ…æ‹¬ï¼š<br><span class="hljs-number">1</span>ã€æ¯ä¸ªè¡Œç»„çš„å…ƒä¿¡æ¯ï¼šç”±å¤šå°‘ä¸ªåˆ—å—ç»„æˆï¼›<br><span class="hljs-number">2</span>ã€æ¯ä¸ªåˆ—å—çš„å…ƒä¿¡æ¯ï¼šç±»å‹ã€è·¯å¾„ã€ç¼–ç ã€ç¬¬ä¸€ä¸ªæ•°æ®é¡µçš„ä½ç½®ã€ç¬¬ä¸€ä¸ªç´¢å¼•é¡µçš„ä½ç½®ã€å‹ç¼©/æœªå‹ç¼©å¤§å°ã€ä»¥åŠä¸€äº›é¢å¤–çš„é…ç½®kv<br><span class="hljs-number">3</span>ã€åˆæœ‰ä¸‰ç§pagï¼š<br>    æ•°æ®é¡µä¸»è¦å­˜å‚¨defination levelsã€repeatition levelsã€value<br>    å­—å…¸é¡µï¼šå­˜å‚¨åˆ—å€¼çš„ç¼–ç å­—æ®µ<br>    ç´¢å¼•é¡µï¼šç”¨æ¥å­˜å‚¨è¯¥é¡µ<br></code></pre></td></tr></table></figure><h2 id="parquetçš„ç¼–ç æ ¼å¼"><a href="#parquetçš„ç¼–ç æ ¼å¼" class="headerlink" title="parquetçš„ç¼–ç æ ¼å¼"></a>parquetçš„ç¼–ç æ ¼å¼</h2><p><a href="https://github.com/apache/parquet-format/blob/master/Encodings.md">https://github.com/apache/parquet-format/blob/master/Encodings.md</a></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">0</span>ã€PLAINï¼šå¦‚æœæ²¡æœ‰å…¶ä»–çš„æœ‰æ•ˆç¼–ç å°±ä¸è¿›è¡Œç¼–ç ï¼Œä¹Ÿå°±æ˜¯plain<br><span class="hljs-number">2</span>ã€PLAIN_DICTIONARY /<span class="hljs-number">8</span>ã€RLE_DICTIONARYï¼šåŸå§‹æ•°æ®çš„å­—å…¸ç¼–ç ï¼Œå­—å…¸å­˜å‚¨åœ¨å­—å…¸é¡µä¸­å¯¹åº”pageä¸­çš„å­—å…¸é¡µã€‚å­—å…¸ä¸­çš„å€¼ä½¿ç”¨RLE/<span class="hljs-type">bit</span>-packing<br>å›åˆç¼–ç å­˜å‚¨ä½æ•´æ•°ã€‚<br>   å­—å…¸é¡µæ ¼å¼ï¼ˆPLAINï¼‰ï¼šå­—å…¸ä¸­çš„æ¡æ•°-æŒ‰å­—å…¸é¡ºåº-ä½¿ç”¨æ™®é€šç¼–ç <br>   æ•°æ®é¡µæ ¼å¼ï¼šç”¨äºå¯¹å­˜å‚¨ä½<span class="hljs-number">1</span>ä¸ªå­—èŠ‚æ¡ç›®idè¿›è¡Œç¼–ç çš„ä½å®½ï¼ˆæœ€å¤§<span class="hljs-number">32</span>ä½ï¼‰ï¼Œè¿™ä¸ªidä½¿ç”¨RLE/<span class="hljs-type">bit</span>-packingæ‰“åŒ…ç¼–ç çš„å€¼ï¼Œåœ¨<span class="hljs-number">2.0</span>ä¸­ä½¿ç”¨RLE/<span class="hljs-keyword">DICTIONARY</span>   <br><span class="hljs-number">3</span>ã€Run Length <span class="hljs-keyword">Encoding</span> / <span class="hljs-type">Bit</span>-Packing Hybridï¼šè¿™ç§ç¼–ç ä½¿ç”¨ä½æ‰“åŒ…å’Œè¿è¡Œé•¿åº¦ç¼–ç çš„ç»„åˆæ¥æ›´æœ‰æ•ˆåœ°å­˜å‚¨é‡å¤å€¼<br>   RLE:è¡Œç¨‹ç¼–ç ï¼Œé‡å¤çš„å€¼è®¡æ•°ã€‚<br>   <span class="hljs-type">bit</span>-packingï¼šä½æ‰“åŒ…ä¸»è¦ç”¨æ¥è§£å†³åºåˆ—åŒ–æ‰€éœ€è¦çš„ä½æ•°<br><span class="hljs-number">4</span>ã€<span class="hljs-type">Bit</span>-packedï¼šä»…æ”¯æŒç¼–ç é‡å¤å’Œå®šä¹‰çº§åˆ«<br><span class="hljs-number">5</span>ã€Delta <span class="hljs-keyword">Encoding</span>ï¼šint32ã€int64<br><span class="hljs-number">6</span>ã€Delta-length byte <span class="hljs-keyword">array</span>ï¼šBYTE_ARRAY<br><span class="hljs-number">7</span>ã€Delta Stringsï¼šBYTE_ARRAY<br><span class="hljs-number">9</span>ã€Byte Stream Splitï¼š <span class="hljs-type">FLOAT</span> <span class="hljs-type">DOUBLE</span><br></code></pre></td></tr></table></figure><h2 id="parquetå…ƒæ•°æ®ä½¿ç”¨ä»€ä¹ˆåºåˆ—åŒ–æ–¹å¼"><a href="#parquetå…ƒæ•°æ®ä½¿ç”¨ä»€ä¹ˆåºåˆ—åŒ–æ–¹å¼" class="headerlink" title="parquetå…ƒæ•°æ®ä½¿ç”¨ä»€ä¹ˆåºåˆ—åŒ–æ–¹å¼"></a>parquetå…ƒæ•°æ®ä½¿ç”¨ä»€ä¹ˆåºåˆ—åŒ–æ–¹å¼</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql">parqutçš„å…ƒæ•°æ®æ˜¯åœ¨æ•´ä¸ª<span class="hljs-type">row</span> <span class="hljs-keyword">group</span>éƒ½å†™å®Œæˆä¹‹åå†è¿›è¡Œå†™å…¥çš„ï¼Œè¿™æ—¶å€™å†™å…¥çš„æ–‡ä»¶çš„å…ƒæ•°æ®ä¿¡æ¯å…¨éƒ¨éƒ½ä¿å­˜å†äº†å†…å­˜ä¸­ï¼Œå¦‚æœè¦è¯»å–çš„è¯ä¹Ÿæ˜¯éœ€è¦æŠŠå…ƒæ•°æ®å…¨éƒ¨éƒ½<br>è¯»å–åˆ°å†…å­˜ä¸­æ‰è¡Œã€‚<br>æŠŠå†…å­˜ä¸­çš„æ•°æ®åºåˆ—åŒ–åˆ°ç£ç›˜ä¸­ï¼Œä½¿ç”¨äº†thriftçš„TCompactProtocolé«˜æ€§èƒ½åºåˆ—åŒ–æ–¹å¼ã€‚<br>thritç›¸å¯¹äºå…¶ä»–åºåˆ—åŒ–æ–¹å¼æ€§èƒ½æ¯”è¾ƒå¥½ï¼Œå…¼å®¹æ€§å¯èƒ½æ¯”è¾ƒå·®ã€‚<br></code></pre></td></tr></table></figure><blockquote><p><a href="https://blog.51cto.com/u_15080016/2620917">https://blog.51cto.com/u_15080016/2620917</a></p></blockquote><h2 id="Sriping-x2F-Assemblyç®—æ³•"><a href="#Sriping-x2F-Assemblyç®—æ³•" class="headerlink" title="Sriping&#x2F;Assemblyç®—æ³•"></a>Sriping&#x2F;Assemblyç®—æ³•</h2><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stata">æ‰“æ•£/ç»„è£…ç®—æ³•ï¼Œä¸»è¦parquetå¦‚ä½•æ‰“æ•£å’Œç»„è£…æ•°æ®çš„ã€‚è¿™ä¸ªç®—æ³•ä¸»è¦é€šè¿‡repetition <span class="hljs-keyword">levels</span>å’Œdefinition <span class="hljs-keyword">levels</span>æ¥æè¿°æ–‡ä»¶çš„æ‹†åˆ†å’Œç»„è£…ã€‚é‡å¤çº§åˆ«ä¸»è¦<br>ç”¨æ¥æè¿°repeatedçš„èŠ‚ç‚¹ï¼Œåœ¨å†™å…¥çš„é€‚åˆç­‰äºå®ƒå’Œå‰é¢çš„å€¼ä»é‚£ä¸€å±‚èŠ‚ç‚¹ä¸å…±äº«çš„ã€‚åœ¨è¯»å–çš„é€‚åˆæ ¹æ®è¯¥å€¼å¯ä»¥æ¨æ–­å‡ºå“ªä¸€å±‚éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ï¼›å®šä¹‰çº§åˆ«ä¸»è¦<br>ç”¨æ¥è®°å½•å“ªäº›å€¼ä½¿æ²¡æœ‰çš„ä½¿nullå€¼ã€‚å¯ä»¥å¾ˆå¥½çš„æ”¯æŒåµŒå¥—ç±»å‹çš„å­˜å‚¨ã€‚<br>repeated <span class="hljs-keyword">levels</span>ä¸»è¦æ˜¯ç”¨æ¥ä¸€åˆ—çš„ä½œç”¨çš„ï¼Œdefintition <span class="hljs-keyword">levels</span>ç”¨æ¥æè¿°ä¸€è¡Œçš„æ•°æ®ã€‚ä¸»è¦é˜²æ­¢ä¸€åˆ—æœ‰ç©ºå€¼å¯¼è‡´é”™ä½ã€‚<br>ä¸åŒçš„åˆ—è·³è½¬ä½¿ç”¨äº†æœ‰é™çŠ¶æ€æœº<br></code></pre></td></tr></table></figure><h2 id="parquetçš„bloomfilter"><a href="#parquetçš„bloomfilter" class="headerlink" title="parquetçš„bloomfilter"></a>parquetçš„bloomfilter</h2><p><a href="https://github.com/apache/parquet-format/blob/master/BloomFilter.md">https://github.com/apache/parquet-format/blob/master/BloomFilter.md</a></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œåœ¨parquetå’Œorcç­‰åˆ—å¼å­˜å‚¨ä¸­ï¼Œéƒ½ä¼šç”¨åˆ°ä¸€äº›ç´¢å¼•å’Œç»Ÿè®¡ä¿¡æ¯ï¼šè®°å½•ä¸‹ä¸€äº›åˆ—çš„æœ€å¤§å€¼æœ€å°å€¼ï¼Œè®°å½•å­—å…¸ç­‰ã€‚ï¼Œæ¥å¯¹æŸ¥è¯¢è¿›è¡Œè°“è¯ä¸‹æ¨ï¼Œ<br>ç›´æ¥ä¸‹æ¨åˆ°æ–‡ä»¶ä¸Šé¢ï¼Œå‡å°‘æ•°æ®çš„ä¼ è¾“ã€‚è°“è¯ä¸‹æ¨å¯ä»¥è¯´æ˜¯æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–çš„ä¸€å¤§æ‰‹æ®µã€‚<br>ä½†æ˜¯åœ¨æœ‰ä¸€äº›æ²¡æœ‰æœ€å¤§å€¼æœ€å°å€¼ï¼Œå­—å…¸å¤ªå¤§ã€æ•°æ®åŸºæ•°éå¸¸å¤§çš„æƒ…å†µä¸‹å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥èµ·åˆ°å¾ˆå¥½çš„ä¼˜åŒ–æ“ä½œã€‚<br>å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥è¿‡æ»¤æ‰è‚¯å®šä¸å­˜åœ¨çš„æ•°æ®ï¼Œå¯èƒ½å­˜åœ¨çš„æ•°æ®æ¥ç›¸åº”æŸ¥è¯¢ã€‚å¯èƒ½å­˜åœ¨çš„æ•°æ®åˆå¯ä»¥é€šè¿‡æ„å»º<span class="hljs-type">bit</span>æ•°ç»„çš„å¤§å°æ¥å†³å®šçš„ã€‚<span class="hljs-type">bit</span>æ•°æ®å ç”¨çš„ç©ºé—´<br>éå¸¸å°ï¼Œä»¥è‡³äºç”¨å¾ˆå°çš„ç©ºé—´å°±å¯ä»¥è¾¾åˆ°å¾ˆå¥½çš„è¿‡æ»¤æ•ˆæœã€‚<br>å…¶å®å¸ƒéš†è¿‡æ»¤å™¨ä¸»è¦çš„ç›®æ ‡å°±æ˜¯ä¸ºÂ·é«˜åŸºæ•°Â·çš„åˆ—å¯ç”¨è°“è¯ä¸‹æ¨ï¼ŒåŒæ—¶ä½¿ç”¨æ›´å°‘çš„å­˜å‚¨ç©ºé—´ã€‚åŒæ—¶å¦‚æœæŸä¸€åˆ—æ²¡æœ‰å¯ç”¨å¸ƒéš†è¿‡æ»¤å™¨ä¹Ÿä¸ä¼šå½±å“æ€§èƒ½ã€‚<br><br>parquetä½¿ç”¨çš„æ˜¯ä¸€ç§split blockå¸ƒéš†è¿‡æ»¤å™¨ã€‚å°±æ˜¯ä¸€ä¸ªåˆ—æœ‰å¤šä¸ªblockï¼Œæ¯ä¸ªblockæœ‰<span class="hljs-number">8</span>ä¸ªå°å—ç»„æˆï¼Œå°å—çš„è¯å…¶å®å°±æ˜¯<span class="hljs-type">bit</span>æ•°ç»„ã€‚ç„¶åé€šè¿‡<br>åŠ ç›ï¼ˆå¯¹åº”<span class="hljs-type">int</span>å°±æ˜¯*å¯¹åº”ä¸€ä¸ªæ•°ç»„ä¿å­˜ç€<span class="hljs-number">8</span>ä¸ª<span class="hljs-number">32</span>ä½çš„æ•´æ•°ä¸€ä¸€å¯¹åº”ï¼‰ç§»ä½æ¥å–å¾—æ¯ä¸ª<span class="hljs-type">bit</span>æ•°ç»„ä¸­çš„å…·ä½“ä½ç½®ï¼Œç„¶åè¿›è¡Œæ’å…¥ã€‚å…¶ä¸­å°±æ˜¯ä¸ºäº†æŠŠå¯¹åº”çš„<br>å€¼è¿›è¡Œæ•£åˆ—ï¼Œä½¿ç”¨äº†å¥‡æ•°*å¸¸æ•°å³ç§»çš„ä¸€ç§æ•£åˆ—æ•´æ•°æ–¹æ³•ã€‚å—è¶Šå¤šå‡†ç¡®ç‡è¶Šé«˜<br><br>é’ˆå¯¹å…¶ä»–ç±»å‹çš„æ•°æ®ï¼Œparquetä½¿ç”¨xxhashæ¥åšçš„è½¬æ¢<br><br>æ•°æ®çš„è¯ä¹Ÿæ˜¯ç›¸å½“äºå…ƒæ•°æ®ä½¿ç”¨çš„thriftåšçš„åºåˆ—åŒ–<br><br>bloomfilterå­˜å‚¨åœ¨äº†footerä¸‹é¢çš„<span class="hljs-keyword">row</span> <span class="hljs-keyword">group</span>çš„<span class="hljs-keyword">column</span> chunkä¸‹é¢ï¼Œä½œä¸ºåˆ—çš„å…ƒæ•°æ®ã€‚<br>æ•æ„Ÿä¿¡æ¯åº”è¯¥ä½¿ç”¨åˆ—åŠ å¯†<br></code></pre></td></tr></table></figure><h2 id="parquetæ–‡ä»¶æ”¯æŒå“ªäº›å‹ç¼©æ–¹å¼"><a href="#parquetæ–‡ä»¶æ”¯æŒå“ªäº›å‹ç¼©æ–¹å¼" class="headerlink" title="parquetæ–‡ä»¶æ”¯æŒå“ªäº›å‹ç¼©æ–¹å¼"></a>parquetæ–‡ä»¶æ”¯æŒå“ªäº›å‹ç¼©æ–¹å¼</h2><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">snappy:</span>googleæä¾›<br><span class="hljs-symbol">gzip:</span>åŸºäºRFC <span class="hljs-number">1952</span>å®šä¹‰çš„ GZIP æ ¼å¼ï¼ˆzlibæƒå¨ï¼‰<br><span class="hljs-symbol">lzo:</span><br><span class="hljs-symbol">brotli:</span><br><span class="hljs-symbol">lz4:</span><br><span class="hljs-symbol">zstd:</span><br><span class="hljs-symbol">lz4_raw:</span><br></code></pre></td></tr></table></figure><h2 id="parquetæ”¯æŒå“ªäº›æ•°æ®ç±»å‹"><a href="#parquetæ”¯æŒå“ªäº›æ•°æ®ç±»å‹" class="headerlink" title="parquetæ”¯æŒå“ªäº›æ•°æ®ç±»å‹"></a>parquetæ”¯æŒå“ªäº›æ•°æ®ç±»å‹</h2><p>æ–‡ä»¶æ ¼å¼çš„æ•°æ®ç±»å‹</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">BOOLEAN</span>ï¼š<span class="hljs-number">1</span> ä½å¸ƒå°”å€¼<br><span class="hljs-attribute">INT32</span>ï¼š<span class="hljs-number">32</span> ä½æœ‰ç¬¦å·æ•´æ•°<br><span class="hljs-attribute">INT64</span>ï¼š<span class="hljs-number">64</span> ä½æœ‰ç¬¦å·æ•´æ•°<br><span class="hljs-attribute">INT96</span>ï¼š<span class="hljs-number">96</span> ä½æœ‰ç¬¦å·æ•´æ•°<br><span class="hljs-attribute">FLOAT</span>ï¼šIEEE <span class="hljs-number">32</span> ä½æµ®ç‚¹å€¼<br><span class="hljs-attribute">DOUBLE</span>ï¼šIEEE <span class="hljs-number">64</span> ä½æµ®ç‚¹å€¼<br><span class="hljs-attribute">BYTE_ARRAY</span>ï¼šä»»æ„é•¿çš„å­—èŠ‚æ•°ç»„ã€‚<br></code></pre></td></tr></table></figure><p>é€»è¾‘æ•°æ®ç±»å‹</p><h2 id="parquetçš„åˆ—ç´¢å¼•"><a href="#parquetçš„åˆ—ç´¢å¼•" class="headerlink" title="parquetçš„åˆ—ç´¢å¼•"></a>parquetçš„åˆ—ç´¢å¼•</h2><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs applescript">columnIndexå’ŒoffsetIndexï¼›ç´¢å¼•çš„ç»“æ„å’Œé•¿åº¦å­˜å‚¨åœ¨läº†columnchunkä¸­<br>columnIndexï¼šè¿™ä¸ªå¯ä»¥æ ¹æ®åˆ¶å®šçš„åˆ—å€¼ç›´æ¥åˆ°æ•°æ®é¡µã€‚å¯ä»¥ç”¨äºè°“è¯ä¸‹æ¨ä¸Šé¢ã€‚<br>offsetindexï¼šè¿™ä¸ªå¯ä»¥æŒ‰ç…§è¡Œæ•°è¿›è¡Œç´¢å¼•ï¼Œè¿™ä¸ªä¸»è¦ç”¨æ¥å…¶ä»–åˆ—æœ‰äº†è¿‡æ»¤ï¼Œè·³è¿‡è®¸å¤šæ•°æ®ï¼Œé‚£ä¹ˆè¿™ä¸ªåˆ—ä¹Ÿä¼šæ ¹æ®<span class="hljs-built_in">offset</span>å»æŒ‘è¿‡å¯¹åº”çš„æ•°æ®ã€‚<br><span class="hljs-number">1</span>ã€ç´¢å¼•é‡Œé¢å³æ•°æ®é¡µçš„æœ€å¤§å€¼å’Œæœ€å°å€¼<br><span class="hljs-number">2</span>ã€é’ˆå¯¹æ’åºçš„åˆ—åªéœ€è¦è¯»å–åŒ…å«æ•°æ®ç›¸å…³çš„ç¡®å®šçš„æ•°æ®é¡µ<br><span class="hljs-number">3</span>ã€é’ˆå¯¹äºè°“è¯ä¸‹æ¨ï¼Œå¯ä»¥é€šè¿‡å­—å…¸ä»¥åŠç´¢å¼•æ‰¾åˆ°ç¡®å®šçš„ç´¢å¼•é¡µ<br><span class="hljs-number">4</span>ã€å¦‚æœä¸éœ€è¦æ“ä½œä¹Ÿä¸ä¼šå¸¦æ¥é¢å¤–çš„å¼€é”€<br><span class="hljs-number">5</span>ã€å¦‚æœæ˜¯å·²ç»æ’åºçš„ï¼Œä»…ä»…å­˜å‚¨è¾¹ç•Œå…ƒç´ <br><span class="hljs-number">6</span>ã€å¯¹äºæœ‰åºçš„åˆ—è¿˜ä¼šè¿ç”¨äºŒåˆ†æŸ¥æ‰¾<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>orc.md</title>
    <link href="/2022/03/02/orc-md/"/>
    <url>/2022/03/02/orc-md/</url>
    
    <content type="html"><![CDATA[<h1 id="ORC-Optimized-Record-Columnar"><a href="#ORC-Optimized-Record-Columnar" class="headerlink" title="ORC(Optimized Record Columnar)"></a>ORC(Optimized Record Columnar)</h1><h2 id="orcæ”¯æŒå“ªäº›æ•°æ®ç±»å‹"><a href="#orcæ”¯æŒå“ªäº›æ•°æ®ç±»å‹" class="headerlink" title="orcæ”¯æŒå“ªäº›æ•°æ®ç±»å‹"></a>orcæ”¯æŒå“ªäº›æ•°æ®ç±»å‹</h2><figure class="highlight sql"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><pre><code class="hljs sql">æ•´æ•°<br>  <span class="hljs-type">boolean</span>ï¼š<span class="hljs-number">1</span>bit<br>  tinyintï¼š<span class="hljs-number">8</span>bit<br>  <span class="hljs-type">smallint</span>ï¼š<span class="hljs-number">16</span>bit<br>  <span class="hljs-type">int</span>ï¼š<span class="hljs-number">32</span>bit<br>  <span class="hljs-type">bigint</span>ï¼š<span class="hljs-number">64</span>bit<br>æµ®ç‚¹<br>  <span class="hljs-type">float</span>ã€<span class="hljs-keyword">double</span><br>å­—ç¬¦ä¸²<br>  stringã€<span class="hljs-type">char</span>ã€<span class="hljs-type">varchar</span><br>å­—èŠ‚<br>  <span class="hljs-type">binary</span> blobs<br>æ—¥æœŸ<span class="hljs-operator">/</span>æ—¶é—´<br>  <span class="hljs-type">timestamp</span>ã€<span class="hljs-type">timestamp</span> <span class="hljs-keyword">with</span> <span class="hljs-keyword">local</span> <span class="hljs-type">time</span> zoneã€<span class="hljs-type">date</span><br>å¤åˆç±»å‹<br>  structã€listã€mapã€<span class="hljs-keyword">union</span><br></code></pre></td></tr></table></figure><h2 id="orcæ”¯æŒå“ªäº›ç´¢å¼•"><a href="#orcæ”¯æŒå“ªäº›ç´¢å¼•" class="headerlink" title="orcæ”¯æŒå“ªäº›ç´¢å¼•"></a>orcæ”¯æŒå“ªäº›ç´¢å¼•</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">file <span class="hljs-keyword">level</span>æ–‡ä»¶çº§åˆ«ï¼šæœ‰å…³æ•´ä¸ªæ–‡ä»¶ä¸­æ¯ä¸€åˆ—çš„ç»Ÿè®¡ä¿¡æ¯ï¼ˆå­˜å‚¨åœ¨é¡µè„šï¼‰<br>stripe <span class="hljs-keyword">level</span>æ¡å¸¦çº§åˆ«ï¼šæ¯ä¸ªæ¡å¸¦çš„æ¯åˆ—å€¼ç»Ÿè®¡ä¿¡æ¯ï¼ˆå­˜å‚¨åœ¨é¡µè„šï¼‰<br><span class="hljs-keyword">row</span> <span class="hljs-keyword">level</span> è¡Œçº§åˆ«ï¼šæ¯<span class="hljs-number">10000</span>hè¡Œæ¯åˆ—ä¸­çš„ç»Ÿè®¡ä¿¡æ¯ï¼ˆå­˜å‚¨åœ¨è¡Œç»„ï¼‰<br>å¸ƒéš†è¿‡æ»¤å™¨ï¼šé’ˆå¯¹ç‰¹å®šçš„åˆ—ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨æœ‰æ•ˆçš„è¿›è¡Œè°“è¯ä¸‹æ¨ orc.bloom.<span class="hljs-keyword">filter</span>.<span class="hljs-keyword">columns</span>ï¼Œä»–è·Ÿ<span class="hljs-keyword">row</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">index</span>äº¤é”™åˆ†å¸ƒçš„ï¼Œé¦–å…ˆæ ¹æ®ç´¢å¼•ç¼©å°æ•°æ®èŒƒå›´<br>å†ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨è¿›ä¸€æ­¥è¿‡æ»¤æ•°æ®ã€‚<br></code></pre></td></tr></table></figure><h2 id="acidæ”¯æŒ"><a href="#acidæ”¯æŒ" class="headerlink" title="acidæ”¯æŒ"></a>acidæ”¯æŒ</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk">ç›®çš„ä¸æ˜¯æ”¯æŒOLTPæ“ä½œï¼Œè€Œæ˜¯æ”¯æŒç™¾ä¸‡è®¡äº‹åŠ¡çš„æ›´æ–°ï¼Œä¸æ˜¯ç™¾ä¸‡æ¬¡äº‹åŠ¡ã€‚åŒæ—¶æœ‰äº†acidè¿˜å¯ä»¥ä¿è¯æµå¼æ•°æ®æ’å…¥åˆ°æ•°æ®è¡¨ä¸­ã€‚<br>å¯ç”¨acidçš„è¡¨ä¼šåœ¨å¯¹åº”çš„ç›®å½•ä¸‹é¢åˆ›å»ºå¢é‡ç›®å½•ã€‚delta_xxx/bucket_xxx,<br>å½“deltaå˜å¤šäº†ä¹‹åï¼Œä¼šè‡ªåŠ¨å¯ç”¨ä¸€äº›å°çš„å‹ç¼©ï¼Œå°†ä¸€ç»„äº‹åŠ¡håˆå¹¶ä½ä¸€ä¸ªå•ç‹¬çš„deltaã€‚<br>å½“å¢é‡æ–‡ä»¶å˜æ‰“äº†ä¹‹åï¼Œä¼šå¯åŠ¨ä»»åŠ¡å»é‡å†™åŸºç¡€+å¢é‡æ–‡ä»¶<br>é’ˆå¯¹orcæ–‡ä»¶é€šè¿‡idã€bucketå’Œrow idæ¥ä¿è¯æ•°æ®çš„å”¯ä¸€ï¼Œå½“æ•°æ®updateã€<span class="hljs-keyword">delete</span>ã€insertå°±æ˜¯ç”¨åˆ°è¿™ä¸‰ä¸ªå€¼ï¼Œå¯¹åº”çš„åºåˆ—åŒ–<span class="hljs-number">0</span> æ’å…¥ <span class="hljs-number">1</span>æ›´æ–° <span class="hljs-number">2</span>åˆ é™¤<br>https:<span class="hljs-regexp">//</span>orc.apache.org<span class="hljs-regexp">/docs/</span>acid.html<br></code></pre></td></tr></table></figure><h2 id="é’ˆå¯¹hiveçš„æ“ä½œ"><a href="#é’ˆå¯¹hiveçš„æ“ä½œ" class="headerlink" title="é’ˆå¯¹hiveçš„æ“ä½œ"></a>é’ˆå¯¹hiveçš„æ“ä½œ</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> istari <span class="hljs-keyword">SET</span> FILEFORMAT ORCï¼šå°†è¡¨æ–°åˆ†åŒºå­˜å‚¨ä½orc<br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> istari [<span class="hljs-keyword">PARTITION</span> partition_spec] CONCATENATEï¼šé’ˆå¯¹åˆ†åŒºè¿›è¡Œåˆå¹¶ï¼Œåœ¨stripeçº§åˆ«ä¸Šé¢è¿›è¡Œåˆå¹¶<br>hive <span class="hljs-comment">--orcfiledump &lt;path_to_file&gt;ï¼šorcæ–‡ä»¶ä¿¡æ¯</span><br>hive <span class="hljs-comment">--orcfiledump -d &lt;path_to_file&gt;ï¼šæ˜¾ç¤ºæ•°æ®</span><br><br>ä¸€äº›å‚æ•°ï¼š<br>orc.compress=ZLIB/<span class="hljs-keyword">NONE</span>/SNAPPY<br>orc.compress.size=<span class="hljs-number">262144</span>ï¼šé’ˆå¯¹æ¯ä¸ªchunk sizeçš„å‹ç¼©å¤§å°<br>oorc.stripe.size=<span class="hljs-number">67108864</span>ï¼šæ¯ä¸ªstripeçš„å¤§å°<br>orc.<span class="hljs-keyword">row</span>.<span class="hljs-keyword">index</span>.stride=<span class="hljs-number">10000</span>ï¼šç´¢å¼•çš„æ¡ç›®æ•°<br>orc.<span class="hljs-keyword">create</span>.<span class="hljs-keyword">index</span>=<span class="hljs-keyword">true</span>ï¼šæ˜¯å¦åˆ›å»ºç´¢å¼•<br>orc.bloom.<span class="hljs-keyword">filter</span>.<span class="hljs-keyword">columns</span>=&quot;&quot;ï¼šéœ€è¦å¼€å¯å¸ƒéš†è¿‡æ»¤å™¨çš„åˆ—<br>orc.bloom.<span class="hljs-keyword">filter</span>.fpp=<span class="hljs-number">0.05</span>ï¼šå¸ƒéš†è¿‡æ»¤å™¨çš„å‡†ç¡®ç‡<br><br>TBLPROPERTIES (&quot;orc.compress&quot;=&quot;NONE&quot;);<br><br>https://orc.apache.org/docs/hive-ddl.html<br>https://orc.apache.org/docs/hive-config.html<br></code></pre></td></tr></table></figure><h2 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">1</span>ã€ORCæ˜¯åˆ—å¼å­˜å‚¨ï¼Œæœ‰å¤šç§æ–‡ä»¶å‹ç¼©æ–¹å¼ï¼Œå‹ç¼©æ¯”ä¾‹ä¹Ÿå¾ˆé«˜ã€‚   <br><span class="hljs-number">2</span>ã€æ–‡ä»¶å¯åˆ‡åˆ†ã€‚å¯åˆ‡åˆ†çš„æ„ä¹‰åœ¨äºï¼Œå¯ä»¥æ§åˆ¶taskçš„æ•°é‡ä»¥åŠå‡å°‘æ•°æ®çš„è¾“å…¥ã€‚   <br><span class="hljs-number">3</span>ã€æä¾›äº†å¤šç§ç´¢å¼•ï¼š<span class="hljs-keyword">row</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">index</span>ã€bloom <span class="hljs-keyword">filter</span> <span class="hljs-keyword">index</span>ã€‚   <br><span class="hljs-number">4</span>ã€æ”¯æŒå¤æ‚çš„æ•°æ®ç»“æ„   <br></code></pre></td></tr></table></figure><h2 id="ä¸ºä»€ä¹ˆåˆ—å¼å­˜å‚¨å¯ä»¥åŠ å¿«olapçš„æŸ¥è¯¢é€Ÿåº¦"><a href="#ä¸ºä»€ä¹ˆåˆ—å¼å­˜å‚¨å¯ä»¥åŠ å¿«olapçš„æŸ¥è¯¢é€Ÿåº¦" class="headerlink" title="ä¸ºä»€ä¹ˆåˆ—å¼å­˜å‚¨å¯ä»¥åŠ å¿«olapçš„æŸ¥è¯¢é€Ÿåº¦"></a>ä¸ºä»€ä¹ˆåˆ—å¼å­˜å‚¨å¯ä»¥åŠ å¿«olapçš„æŸ¥è¯¢é€Ÿåº¦</h2><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs arcade">æ¯ä¸€åˆ—çš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯é¡ºåºå­˜å‚¨çš„ï¼Œè¿™æ ·å¯ä»¥å¸¦æ¥çš„å¥½å¤„å°±æ˜¯ï¼š   <br><span class="hljs-number">1</span>ã€æŸ¥è¯¢çš„æ—¶å€™ä¸éœ€è¦æ‰«æå…¨éƒ¨æ•°æ®ï¼Œåªéœ€è¦æ‰«æå¯¹åº”çš„åˆ—æ•°æ®å°±å¯ä»¥ï¼Œè¿˜æœ‰å°±æ˜¯orcä¿å­˜ç€æ¯ä¸€åˆ—çš„ç»Ÿè®¡ä¿¡æ¯åŒ…æ‹¬<span class="hljs-built_in">min</span> <span class="hljs-built_in">max</span> <span class="hljs-built_in">sum</span>ç­‰ï¼Œè¿™æ ·é…åˆhiveçš„è°“è¯ä¸‹æ¨ä¼˜åŒ–å™¨<br>å¯ä»¥å®ç°è°“è¯ä¸‹æ¨åˆ°æ•°æ®ç»“æ„çš„åº•å±‚ï¼Œå®Œç¾å‡å°‘äº†æ•°æ®çš„è¾“å…¥ï¼Œæ²¡æœ‰å¿…é¡»çš„æ•°æ®å†æ•°æ®è¯»å–çš„æ—¶å€™å®Œå…¨é¿å…äº†ã€‚   <br><span class="hljs-number">2</span>ã€æ¯ä¸€åˆ—çš„æˆå‘˜éƒ½æ˜¯åŒæ„çš„ï¼Œå¯ä»¥é’ˆå¯¹ä¸åŒçš„æ•°æ®ç±»å‹ä½¿ç”¨æ›´é«˜æ•ˆçš„å‹ç¼©ç®—æ³•ï¼Œè¿›ä¸€æ­¥å‡å°‘I/Oã€‚   <br><span class="hljs-number">3</span>ã€æ¯ä¸€ç±»çš„æˆå‘˜éƒ½æ˜¯åŒæ„æ€§ï¼Œæ›´åŠ å®ç”¨CPU pipelineçš„ç¼–ç æ–¹å¼ï¼Œå‡å°‘CPUç¼“å­˜å¤±æ•ˆ<br></code></pre></td></tr></table></figure><h2 id="æ•°æ®æ¨¡å‹"><a href="#æ•°æ®æ¨¡å‹" class="headerlink" title="æ•°æ®æ¨¡å‹"></a>æ•°æ®æ¨¡å‹</h2><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs arcade">ORCçš„ç»“æ„ä¸­åŒ…å«äº†è´Ÿè´£ç±»å‹å’ŒåŸå§‹ç±»å‹ï¼Œå‰è€…åŒ…æ‹¬list struck <span class="hljs-built_in">map</span> <span class="hljs-built_in">union</span> åè€…æœ‰<span class="hljs-built_in">boolean</span>ã€æ•´æ•°ã€æµ®ç‚¹ç­‰ã€‚structçš„å­©å­å¯èƒ½åŒ…æ‹¬å¤šä¸ªå­©å­èŠ‚ç‚¹ï¼Œ<span class="hljs-built_in">map</span>æœ‰ä¿©ä¸ª<br>å­©å­èŠ‚ç‚¹ï¼Œlistæœ‰ä¸€ä¸ªå­©å­èŠ‚ç‚¹ã€‚æ¯ä¸ª<span class="hljs-built_in">schema</span>æ ¹èŠ‚ç‚¹æ˜¯å“Ÿä¸ªstruckç±»å‹ï¼Œ æ‰€æœ‰çš„columnæŒ‰ç…§æ ‘çš„ä¸­åºéå†é¡ºåºç¼–å·ã€‚<br>&gt; ORCåªéœ€è¦å­˜å‚¨<span class="hljs-built_in">schema</span>æ ‘ä¸­å¶å­èŠ‚ç‚¹çš„å€¼ï¼Œè€Œä¸­é—´çš„éå¶å­èŠ‚ç‚¹åªæ˜¯åšäº†ä¸€å±‚ä»£ç†ï¼Œåªéœ€è¦è´Ÿè´£å­©å­èŠ‚ç‚¹å€¼çš„æ•°æ®è¯»å–ï¼Œåªæœ‰çœŸæ­£çš„çš„å¶å­èŠ‚ç‚¹æ‰ä¼šè¯»å–æ•°æ®ï¼Œç„¶å<br>&gt; ç”±æ ‘èŠ‚ç‚¹å°è£…æˆå¯¹åº”çš„æ•°æ®ç»“æ„è¿”å›<br></code></pre></td></tr></table></figure><h2 id="orcç›¸å¯¹rcfileä¼˜åŠ¿"><a href="#orcç›¸å¯¹rcfileä¼˜åŠ¿" class="headerlink" title="orcç›¸å¯¹rcfileä¼˜åŠ¿"></a>orcç›¸å¯¹rcfileä¼˜åŠ¿</h2><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-number">1</span>ã€æ¯ä¸ªtaskå•ç‹¬è¾“å‡ºå•ä¸€æ–‡ä»¶ï¼Œå‡å°‘äº†namenodeçš„è´Ÿè½½<br><span class="hljs-number">2</span>ã€æ”¯æŒå¤æ‚æ•°æ®ç±»å‹<br><span class="hljs-number">3</span>ã€æ–‡ä»¶çº§åˆ«çš„è½»é‡åŒ–ç´¢å¼•ï¼šå¯ä»¥è·³è¿‡å¯¹åº”row groupã€‚å®šä½è¡Œæ•°æ®<br><span class="hljs-number">4</span>ã€æ ¹æ®æ•°æ®ç±»å‹æ¥è¿›è¡ŒåŸºäº<span class="hljs-keyword">blockçš„æ•°æ®å‹ç¼©ï¼Œå¤šç§å‹ç¼©ç¼–ç  </span>RLE <span class="hljs-keyword">DIRECT</span><br><span class="hljs-keyword"></span><span class="hljs-number">5</span>ã€ä½¿ç”¨ç‹¬ç«‹çš„recordReaderå¹¶è¡Œè¯»å–åŒä¸€ä¸ªæ–‡ä»¶<br><span class="hljs-number">6</span>ã€ä¸å¿…æ‰«ææ ‡è¯†å°±å¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œåˆ‡åˆ†<br><span class="hljs-number">7</span>ã€é™å®šè¯»å†™éœ€è¦çš„å†…å­˜<br><span class="hljs-number">8</span>ã€å…ƒæ•°æ®ä»¥protocol <span class="hljs-keyword">bufferå­˜å‚¨ï¼Œå…è®¸å¢åŠ åˆ é™¤åŸŸ</span><br><span class="hljs-keyword"></span><span class="hljs-number">9</span>ã€å‹ç¼©æ–¹é¢æ”¯æŒæ›´å¤šçš„å‹ç¼©æ–¹å¼ zlib snappy<br></code></pre></td></tr></table></figure><h2 id="æ–‡ä»¶ç»“æ„"><a href="#æ–‡ä»¶ç»“æ„" class="headerlink" title="æ–‡ä»¶ç»“æ„"></a>æ–‡ä»¶ç»“æ„</h2><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs clean">å°¾éƒ¨å¼€å§‹è¯»å–ï¼Œé¦–å…ˆæ˜¯magic <span class="hljs-keyword">code</span><br>postscriptï¼šfile footerçš„é•¿åº¦ã€æ–‡ä»¶çš„å‹ç¼©æ–¹å¼ã€å‹ç¼©å¤§å°ã€å…ƒæ•°æ®çš„é•¿åº¦ã€æ–‡ä»¶çš„ç‰ˆæœ¬å·<br>file footerï¼šstripeåˆ—è¡¨ï¼Œæ¯ä¸ªstripeçš„è¡Œæ•°ï¼Œåˆ—çš„æ•°æ®ç±»å‹ï¼Œåˆ—çš„èšåˆä¿¡æ¯count min max sum<br>    stripe informationï¼šoffsetã€ç´¢å¼•çš„é•¿åº¦ã€æ•°æ®çš„é•¿åº¦ã€footerçš„é•¿åº¦ã€ä»¥åŠstropeçš„è¡Œæ•°<br>    type informationï¼šschemaä¿¡æ¯æ˜¯è¡¨å¤§æˆäº†ä¸€é¢—æ ‘ç»“æ„ï¼Œé€šè¿‡å…ˆåºéå†åºåˆ—åŒ–protocol bufferåˆ°æ–‡ä»¶é‡Œé¢<br>    column statisticsï¼šè¡Œæ•°ã€æœ€å¤§å€¼ã€æœ€å°å€¼ã€æ±‚å’Œã€æ˜¯å¦æœ‰nullï¼Œå¯èƒ½å¯¹ä¸åŒçš„æ•°æ®ç±»å‹å®šä¹‰äº†ä¸åŒçš„ç»Ÿè®¡ä¿¡æ¯<br>    user metadataï¼šè¿™ä¸ªæ˜¯ç”¨æˆ·è‡ªå·±å¯ä»¥è®¾ç½®ä¸€äº›kvå­˜å‚¨ï¼Œæ–¹ä¾¿è¯»å–çš„æ—¶å€™ä½¿ç”¨ã€‚<br>    file metadataï¼šæ•´ä¸ªåˆ—çš„ï¼ˆå¯èƒ½å¤šä¸ªstripeï¼‰ç»Ÿè®¡ä¿¡æ¯ï¼Œæ¥å†æ•°æ®åˆ†ç‰‡çš„æ—¶å€™å°±è¿›è¡Œæ•°æ®è°“è¯ä¸‹æ¨è¿‡æ»¤æ•°æ®<br>scripeï¼š<br>    index data<br>        åˆ—ç´¢å¼•ï¼šæœ€å¤§å€¼ã€æœ€å°å€¼ã€ä»¥åŠä»–ä»¬çš„offsetã€‚<br>            è¡Œç´¢å¼• ç´¢å¼•ï¼šæä¾›äº†offsetï¼Œèƒ½å¤Ÿå®šä½å…·ä½“çš„æ•°æ®å—ä»¥åŠå­—èŠ‚ä½ç½®ï¼ˆå¯ä»¥ç›´æ¥è·³è¿‡ä¸éœ€è¦çš„è¡Œæ•°ï¼‰<br>    row dataï¼š<br>        åˆ—æ•°æ®ï¼š<br>            åˆ—çš„å…ƒæ•°æ®ï¼š<br>            å®é™…æ•°æ®<br>    scripe footerï¼šæ¯ä¸ªstreamçš„ä¿¡æ¯ä»¥åŠç¼–ç <br>        Streamï¼šç§ç±»ã€å¯¹åº”çš„idã€å¤§å°ã€å­—å…¸ã€è¡Œç´¢å¼•<br>        columnEncodingï¼šå­—å…¸ç¼–ç ã€è¡Œç¨‹ç¼–ç <br>        <br><br><br><br>å’Œparquetç±»å‹ï¼Œorcä¹Ÿæ˜¯ä½¿ç”¨äºŒè¿›åˆ¶æ–¹å¼å­˜å‚¨çš„ï¼Œæ‰€ä»¥ä¸å¯ä»¥ç›´æ¥è¯»å–ï¼Œorcä¹Ÿæ˜¯è‡ªå¸¦è§£æçš„ï¼ŒåŒ…å«å¾ˆå¤šå…ƒæ•°æ®ï¼Œè¿™äº›å…ƒæ•°æ®éƒ½æ˜¯åŒæ„protoBufferè¿›è¡Œåºåˆ—åŒ–çš„ï¼Œ<br>###ORCæ–‡ä»¶<br>ä¿å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ™®é€šäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¸€ä¸ªORCæ–‡ä»¶ä¸­å¯ä»¥ç”±å¤šä¸ªstripeï¼Œæ¯ä¸€ä¸ªstripeåŒ…å«å¤šæ¡è®°å½•ï¼ŒæŒ‰ç…§ç±»è¿›è¡Œç‹¬ç«‹å­˜å‚¨ï¼Œå¯¹åº”parquetçš„row groupæ¦‚å¿µ<br>###æ–‡ä»¶çº§å…ƒæ•°æ®<br>åŒ…æ‹¬æ–‡ä»¶æè¿°ç¬¦ä¿¡æ¯PostScriptã€æ–‡ä»¶metaä¿¡æ¯ã€æ‰€æœ‰striptçš„ä¿¡æ¯å’Œæ–‡ä»¶schemaä¿¡æ¯<br>###stipe<br>ä¸€ç»„è¡Œå½¢æˆä¸€ä¸ªstripeï¼Œæ¯æ¬¡è¯»å–çš„æ—¶å€™ä»¥è¡Œç»„ä¸ºå•ä½ï¼Œä¸€èˆ¬HDFSçš„å—å¤§å°ï¼Œä¿å­˜äº†æ¯ä¸€åˆ—çš„ç´¢å¼•å’Œæ•°æ®<br>###stripeå…ƒæ•°æ®<br>ä¿å­˜stripeçš„ä½ç½®ï¼Œæ¯ä¸€åˆ—åœ¨è¯¥stripeçš„ç»Ÿè®¡ä¿¡æ¯ä»¥åŠæ‰€æœ‰streamç±»å‹å’Œä½ç½®<br>###row group<br>ç´¢å¼•çš„æœ€å°å•ä½ï¼Œä¸€ä¸ªstripeåŒ…å«å¤šä¸ªrow groupï¼Œé»˜è®¤<span class="hljs-number">10000</span>ä¸ªå€¼ç»„æˆã€‚<br>###stream<br>ä¸€ä¸ªstreamè¡¨ç¤ºæ–‡ä»¶ä¸­ä¸€æ®µæœ‰æ•ˆçš„æ•°æ®ï¼ŒåŒ…æ‹¬ç´¢å¼•å’Œæ•°æ®ä¿©ç±»ï¼Œç´¢å¼•streamä¿å­˜äº†æ¯ä¸ªrow groupçš„ä½ç½®å’Œç»Ÿè®¡ä¿¡æ¯ï¼Œæ•°æ®streamåŒ…æ‹¬å¤šç§ç±»å‹çš„æ•°æ®ï¼Œå…·ä½“å“ªå‡ <br>ç§æ˜¯ç”±è¯¥åˆ—ç±»å‹å’Œç¼–ç æ–¹å¼å†³å®šã€‚<br>###ç»Ÿè®¡ä¿¡æ¯<br>ORCæ–‡ä»¶ä¸­ä¿å­˜äº†ä¸‰ä¸ªå±‚çº§çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œåˆ†åˆ«ä¸ºæ–‡ä»¶çº§åˆ«ã€striptçº§åˆ«å’Œrow group çº§åˆ«çš„ï¼Œä»–ä»¬éƒ½å¯ä»¥ä½œä¸ºè°“è¯ä¸‹æ¨çš„æ¡ä»¶ï¼Œåˆ¤æ–­æ˜¯å¦å¯ä»¥è·³è¿‡æŸäº›æ•°æ®ï¼Œåœ¨ç»Ÿè®¡<br>ä¿¡æ¯ä¸­éƒ½åŒ…å«æ•°æ®å’Œæ˜¯å¦ç”±nullå€¼ï¼Œå¹¶ä¸”å¯¹äºä¸åŒçš„ç±»å‹æ•°æ®è®¾ç½®ä¸€äº›ç‰¹å®šçš„ç»Ÿè®¡ä¿¡æ¯<br>####file level<br>åœ¨ORCæ–‡ä»¶çš„æœ«å°¾ä¼šè®°å½•æ–‡ä»¶çº§åˆ«çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œä¼šè®°å½•æ•´ä¸ªæ–‡ä»¶ä¸­columnsçš„ç»Ÿè®¡ä¿¡æ¯ï¼Œè¿™äº›ç»Ÿè®¡ä¿¡æ¯ä¸»è¦æ˜¯å †æŸ¥è¯¢çš„ä¼˜åŒ–ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¸€äº›ç®€å•çš„èšåˆæŸ¥è¯¢çš„è¾“å‡ºç»“æœ<br>####stripe level<br>ORCæ–‡ä»¶ä¼šä¿å­˜æ¯ä¸ªå­—æ®µstripeçº§åˆ«çš„ç»Ÿè®¡ä¿¡æ¯ï¼ŒORC readerä½¿ç”¨è¿™äº›ç»Ÿè®¡ä¿¡æ¯æ¥ç¡®å®šå¯¹äºæŸ¥è¯¢è¯­å¥æ¥è¯´ï¼Œéœ€è¦è¯»å–å“ªäº›stripeè®°å½•ï¼Œæ¯”å¦‚æŸä¸ªstripeçš„å­—æ®µç»Ÿè®¡<br>max(A) = <span class="hljs-number">10</span> min(A) = <span class="hljs-number">4</span>,é‚£ä¹ˆé’ˆå¯¹äº<span class="hljs-keyword">where</span>æ¡ä»¶ A&gt;<span class="hljs-number">10</span> å’Œ A&lt;<span class="hljs-number">4</span>çš„è¯ï¼Œè¿™ä¸ªstripeéƒ½ä¸ä¼šè¢«è¯»å–<br>####row level<br>ä¸ºäº†è¿›ä¸€æ­¥é¿å…è¯»å–ä¸å¿…è¦çš„æ•°æ®ï¼Œåœ¨é€»è¾‘ä¸Šå°†ä¸€ä¸ªcolumnçš„indexä»¥ä¸€ä¸ªç‰¹å®šç»™å®šçš„å€¼ï¼ˆ<span class="hljs-number">10000</span>ï¼‰åˆ†å‰²å¤šä¸ªindexç»„ã€‚ä»¥<span class="hljs-number">10000</span>æ¡è®°å½•ä¸ºä¸€ä¸ªç»„ï¼Œå¯¹æ•°æ®è¿›è¡Œç»Ÿè®¡ã€‚<br>hiveçš„æŸ¥è¯¢å¼•æ“ä¼šå°†<span class="hljs-keyword">where</span>æ¡ä»¶çš„çº¦æŸä¼ é€’ç»™ORC readerï¼Œè¿™äº›readeræ ¹æ®ç»„çº§åˆ«çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œæ›´ç»†ç²’åº¦è¿‡æ»¤æ‰ä¸éœ€è¦çš„æ•°æ®ï¼Œ<br></code></pre></td></tr></table></figure><h2 id="æ•°æ®è¯»å–"><a href="#æ•°æ®è¯»å–" class="headerlink" title="æ•°æ®è¯»å–"></a>æ•°æ®è¯»å–</h2><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs oxygene"> è¯»å–ORCæ–‡ä»¶æ˜¯ä»å°¾éƒ¨å¼€å§‹è¯»å–çš„ï¼Œç¬¬ä¸€æ¬¡è¯»å–<span class="hljs-number">16</span>KBçš„å¤§å°ï¼Œå°½å¯èƒ½çš„æŠŠpostsriptå’Œfooteræ•°æ®è¯»å–åˆ°å†…å­˜ï¼Œæœ€åä¸€ä¸ªå­—èŠ‚ä¿å­˜ç€postscripeçš„é•¿åº¦ï¼Œä»–çš„é•¿åº¦<br>ä¸ä¼šæŸ¥è¿‡<span class="hljs-number">256</span>å­—èŠ‚ï¼Œpostscriptä¿å­˜ç€æ•´ä¸ªæ–‡ä»¶çš„å…ƒæ•°æ®ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ–‡ä»¶çš„å‹ç¼©æ ¼å¼ã€æ–‡ä»¶å†…éƒ¨çš„æ¯ä¸€ä¸ªå‹ç¼©å—çš„æœ€å¤§é•¿åº¦ï¼ˆæ¯æ¬¡åˆ†é…å†…å­˜çš„å¤§å°ï¼‰ã€footeré•¿åº¦ï¼Œ<br>ä»¥åŠä¸€äº›ç‰ˆæœ¬ä¿¡æ¯ã€‚åœ¨postscriptå’Œfooterä¹‹é—´å­˜å‚¨ç€æ•´ä¸ªæ–‡ä»¶çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œè¿™éƒ¨åˆ†ç»Ÿè®¡åŒ…æ‹¬æ¯ä¸€ä¸ªstripeä¸­æ¯ä¸€åˆ—çš„çš„ä¿¡æ¯ï¼Œä¸»è¦ç»Ÿè®¡æˆå‘˜æ•°ï¼Œæœ€å¤§å€¼ã€æœ€å°å€¼ã€<br>æ˜¯å¦æœ‰ç©ºå€¼ç­‰ã€‚   <br>  æ¥ä¸‹æ¥è¯»å–footerä¿¡æ¯ï¼Œå®ƒåŒ…å«äº†æ²¡æœ‰ç»™stripeçš„é•¿åº¦å’Œåç§»é‡ï¼Œè¯¥æ–‡ä»¶çš„schemaä¿¡æ¯ã€æ•´ä¸ªæ–‡ä»¶çš„ç»Ÿè®¡ä¿¡æ¯ä»¥åŠæ¯ä¸€ä¸ªrow <span class="hljs-keyword">group</span>çš„è¡Œæ•°ã€‚   <br>  å¤„ç†stripeæ—¶é¦–å…ˆä»footerè¯»å–æ¯ä¸ªstripeçš„èµ·å§‹ä½ç½®å’Œé•¿åº¦ã€æ¯ä¸€ä¸ªstripeçš„footeræ•°æ®ï¼ˆå…ƒæ•°æ®ï¼Œè®°å½•äº†<span class="hljs-keyword">index</span>å’Œdataçš„é•¿åº¦ï¼‰ï¼Œæ•´ä¸ªstripeè¢«åˆ†ä¸º<br><span class="hljs-keyword">index</span>å’Œdataä¿©éƒ¨åˆ†ã€‚stripeå†…éƒ¨æ˜¯æŒ‰ç…§row <span class="hljs-keyword">group</span>åˆ†å—çš„ï¼ˆæ¯ä¸€ä¸ªrow <span class="hljs-keyword">group</span>ä¸­æœ‰å¤šå°‘è¡Œåœ¨footerä¸­å­˜å‚¨ï¼‰ï¼Œrow <span class="hljs-keyword">group</span>æŒ‰ç…§åˆ—å­˜å‚¨ã€‚æ¯ä¸ªrow <span class="hljs-keyword">group</span>ç”±å¤šä¸ª<br>streamä¿å­˜æ•°æ®å’Œç´¢å¼•ä¿¡æ¯ã€‚æ¯ä¸€ä¸ªstreamçš„æ•°æ®ä¼šæ ¹æ®è¯¥åˆ—çš„æ•°æ®ç±»å‹ä½¿ç”¨ç‰¹å®šçš„å‹ç¼©ç®—æ³•ä¿å­˜ã€‚   <br>  åˆå§‹åŒ–å…¨éƒ¨å…ƒæ•°æ®çš„ä¹‹åï¼Œå¯ä»¥æ ¹æ®includesæ•°ç»„æŒ‡å®šéœ€è¦è¯»å–çš„åˆ—ç¼–å·ï¼Œå¯ä»¥æ ¹æ®SearchArgumentå‚æ•°æŒ‡å®šè¿‡æ»¤æ¡ä»¶ã€‚è¿™ä¸­é—´å°±é€šè¿‡ç»Ÿè®¡ä¿¡æ¯è¿‡æ»¤æ‰ä¸éœ€è¦çš„<br>æ•°æ®ï¼Œè¿™æ—¶å€™ä¹Ÿä¼šäº§ç”Ÿæ¯”è¾ƒå¤šçš„é›¶æ•£æ•°æ®ï¼ŒORCä¼šå°½å¯èƒ½çš„åˆå¹¶å°æ–‡ä»¶ï¼Œå‡å°‘IOæ¬¡æ•°ã€‚   <br>  ORCä¸æ”¯æŒè¯»å–ç‰¹å®šå­—æ®µç±»å‹ä¸­æŒ‡å®šçš„éƒ¨åˆ†ã€‚   <br>  ä½¿ç”¨ORCå­˜å‚¨çš„æ—¶å€™ï¼Œå°½é‡ä½¿ç”¨HDFSæ¯ä¸€ä¸ª<span class="hljs-keyword">block</span>ä¿å­˜ä¸€ä¸ªstripeï¼Œå¯¹äºä¸€ä¸ªorcæ–‡ä»¶æ¥è¯´ï¼Œstripeçš„å¤§å°ä¸€èˆ¬è®¾ç½®çš„æ¯”<span class="hljs-keyword">block</span>å°ï¼Œå¦åˆ™çš„è¯ä¸€ä¸ªstripeå°±ä¼šåˆ†<br>éƒ¨åˆ°ä¸åŒçš„<span class="hljs-keyword">block</span>ä¸Šé¢å»ï¼Œè¯»å–çš„æ—¶å€™å°±éœ€è¦è¿œç¨‹è¯»å–æ•°æ®ã€‚å¦‚æœè®¾ç½®çš„stripeåªä¿å­˜åœ¨ä¸€ä¸ª<span class="hljs-keyword">block</span>ä¸Šé¢çš„è¯ï¼Œå¦‚æœå½“å‰çš„<span class="hljs-keyword">block</span>å‰©ä½™ç©ºé—´ä¸è¶³å¯ä»¥å­˜å‚¨ä¸€ä¸ªstripe<br>,ORCçš„<span class="hljs-keyword">write</span>å°±ä¼šå°†æ•°æ®æ‰“æ•£ä¿å­˜åœ¨åœ¨<span class="hljs-keyword">block</span>å‰©ä½™çš„ç©ºé—´ä¸­ï¼Œç›´åˆ°è¿™ä¸ª<span class="hljs-keyword">block</span>å­˜å‚¨æ»¡ï¼Œè¿™æ ·çš„è¯ä¸‹é›¨ç»™stripeå°±å¯ä»¥ä»ä¸‹ä¸€ä¸ª<span class="hljs-keyword">block</span>ä¸Šé¢å¼€å§‹å­˜å‚¨ã€‚    <br>  ç”±äºORCä½¿ç”¨äº†æ›´åŠ ç²¾ç¡®çš„ç´¢å¼•ä¿¡æ¯ï¼Œä½¿å¾—è¯»å–æ•°æ®å¯ä»¥ä»ä»»æ„ä¸€è¡Œå¼€å§‹è¯»å–ï¼Œæ›´ç»†ç²’åº¦çš„ç»Ÿè®¡ä¿¡æ¯å¯ä»¥ä½¿ORCæ–‡ä»¶è·³è¿‡æ•´ä¸ªrow <span class="hljs-keyword">group</span>ï¼Œorcé»˜è®¤ä¼šå¯¹ä»»æ„æ•°æ®ä½¿ç”¨<br>zlibå‹ç¼©ï¼Œå› æ­¤orcçš„å­˜å‚¨ç©ºé—´æ›´å°ã€‚<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>orcå’Œparquet</title>
    <link href="/2022/02/09/orc-vs-parquet-md/"/>
    <url>/2022/02/09/orc-vs-parquet-md/</url>
    
    <content type="html"><![CDATA[<h1 id="orc-vs-parquet"><a href="#orc-vs-parquet" class="headerlink" title="orc vs parquet"></a>orc vs parquet</h1><p>orcå’Œparquetæ˜¯æˆ‘ä»¬åœ¨hiveä¸­å¸¸ç”¨ç‚¹åˆ—å¼å­˜å‚¨æ ¼å¼ï¼Œå„è‡ªæœ‰å„è‡ªç‚¹ç‰¹ç‚¹ï¼Œä¸‹é¢ä»‹ç»ä¸€ä¸‹çƒˆå£«å­˜å‚¨ç‚¹ä¼˜åŠ¿ä»¥åŠå®ƒä»¬ä¹‹é—´ç‚¹å·®å¼‚ã€‚</p><h2 id="åˆ—å¼å­˜å‚¨çš„ä¼˜åŠ¿"><a href="#åˆ—å¼å­˜å‚¨çš„ä¼˜åŠ¿" class="headerlink" title="åˆ—å¼å­˜å‚¨çš„ä¼˜åŠ¿"></a>åˆ—å¼å­˜å‚¨çš„ä¼˜åŠ¿</h2><p>åˆ—å¼å­˜å‚¨æŠŠæ¯åˆ—æ•°æ®å­˜åœ¨ä¸€èµ·ï¼ŒåŒç±»å‹çš„åˆ—æ”¾åœ¨ä¸€èµ·ï¼Œé€šè¿‡LRUã€å­—å…¸ã€bit-packingç­‰ç¼–ç å¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šå‡å°‘æ•°æ®çš„å­˜å‚¨ï¼Œå¯¹åŒç±»å‹æ•°æ®çš„å‹ç¼©æ•ˆæœä¹Ÿæ¯”æ··åˆç±»å‹çš„å‹ç¼©å¥½å¾ˆå¤šã€‚æ¯åˆ—æ•°æ®åœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬åœ¨æŸ¥è¯¢çš„æ˜¯åŒå¯ä»¥é€šè¿‡æ˜ å°„ä¸‹æ¨æœ‰æ•ˆçš„å»é™¤ä¸éœ€è¦çš„åˆ—ï¼Œå…¶å®ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨hiveã€sparkç­‰olapç­‰å¼•æ“ä¸­æœ€å¸¸ç”¨çš„ä¼˜åŒ–æ‰‹æ®µï¼Œé€šè¿‡åªè¯»å–æˆ‘ä»¬éœ€è¦çš„åˆ—ï¼Œå¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šé¢å‡å°‘ioæé«˜æˆ‘ä»¬åˆ†æçš„æ€§èƒ½ã€‚å…¶æ¬¡å°±æ˜¯é€šè¿‡åˆ—å¼å­˜å‚¨ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹åˆ—ã€å—ã€é¡µç­‰æ•°æ®ç»“æ„æ·»åŠ ä¸Šæˆ‘ä»¬éœ€è¦çš„ç´¢å¼•ï¼Œé€šè¿‡è¿™äº›ç´¢å¼•å’Œoffsetæˆ‘ä»¬å°±å¯ä»¥å¾ˆå¥½çš„åœ¨æ•°æ®æ–‡ä»¶ä¸Šé¢ä½¿ç”¨è°“è¯ä¸‹æ¨ï¼Œè¿›ä¸€æ­¥è¿‡æ»¤æ‰æˆ‘ä»¬ä¸éœ€è¦çš„æ•°æ®ï¼Œé™¤äº†ç´¢å¼•ä¹‹å¤–orcå’Œparquetéƒ½ä½¿ç”¨äº†å¸ƒéš†è¿‡æ»¤å™¨ï¼Œé€šè¿‡æ·»åŠ å¯¹å­—æ®µçš„å¸ƒéš†è¿‡æ»¤å™¨æ¥è¿‡æ»¤æ‰æ— ç”¨çš„æ•°æ®ï¼Œä»è€Œä½¿æˆ‘ä»¬çš„è®¡ç®—æ›´åŠ é«˜æ•ˆã€‚</p><h2 id="orc-vs-parquet-1"><a href="#orc-vs-parquet-1" class="headerlink" title="orc vs parquet"></a>orc vs parquet</h2><p>1ã€æ”¯æŒç±»å‹ä¸Šï¼Œparqueté€šè¿‡sriping&#x2F;assemblyç®—æ³•å®Œç¾æ”¯æŒåµŒå¥—ç»“æ„ã€‚orcæ”¯æŒå¤æ‚çš„æ•°æ®ç±»å‹ï¼Œå¯¹åµŒå¥—ç±»å‹æ”¯æŒè¾ƒå·®ã€‚<br>2ã€ç´¢å¼•ä¸Šï¼Œparquetå’Œorcéƒ½æœ‰ç»Ÿè®¡ä¿¡æ¯ä»¥åŠoffsetç´¢å¼•ï¼Œå¹¶ä¸”éƒ½æ”¯æŒåˆ—çš„å¸ƒéš†è¿‡æ»¤å™¨ã€‚<br>3ã€æ–‡ä»¶ç»“æ„ä¸Šï¼Œparquetæ˜¯row groupã€column chunkã€pagã€‚orcæ˜¯stipeã€row groupã€streamã€‚æ€»ä½“ç»“æ„ä¸Šé¢æ¯”è¾ƒç±»ä¼¼<br>4ã€å‹ç¼©ä¸Šé¢ï¼Œparquetæ”¯æŒsnappyã€gzipã€lzoã€brotliã€lz4ã€zstdã€lz4_rawï¼›orcæ”¯æŒsnappyã€zlibã€noneä¸‰ç§<br>5ã€æ‰©å±•æ€§ä¸Šï¼Œparquetæ”¯æŒçš„ç»„ä»¶æ‰©å±•æ€§æ›´å¥½ï¼Œå¯¹äºsparkä¹Ÿæ˜¯é»˜è®¤çš„å­˜å‚¨ã€‚è€Œorcæ˜¯rcfileçš„å‡çº§ç‰ˆæœ¬ï¼Œå¯¹hiveçš„æ”¯æŒæ€§ä¼˜åŒ–æ€§æ›´å¥½ã€‚<br>6ã€parquetæ˜¯clouderaå¼€å‘çš„ï¼›orcæ˜¯hortonworkså¼€å‘çš„ã€‚ç°åœ¨ä¿©å®¶å…¬å¸åˆå¹¶æ¥äº†ã€‚<br>7ã€ç¼–ç ä¸Šï¼šparquetæ”¯æŒæ›´å¤šçš„ç¼–ç æ ¼å¼ï¼Œ<br>8ã€å…ƒæ•°æ®ï¼šparquetä½¿ç”¨thriftçš„TCompactProtocolè¿›è¡Œå…ƒæ•°æ®åºåˆ—åŒ–ï¼Œorcä½¿ç”¨protocol bufferè¿›è¡Œå…ƒæ•°æ®çš„åºåˆ—åŒ–</p><p>parquetç›¸å¯¹äºorcçš„ä¼˜åŠ¿ï¼šparqueté€šè¿‡sriping&#x2F;assemblyç®—æ³•å®Œç¾æ”¯æŒåµŒå¥—ç±»å‹ï¼Œåƒjsonã€thriftã€protocolbufferç­‰é€šè¿‡defintion levelå’Œrepeated leveæ–¹ä¾¿å¯¹å…¶è¿›è¡Œç¼–ç ä»¥åŠå‹ç¼©ï¼Œparqueté‡Œé¢ä½¿ç”¨åˆ°çš„ç¼–ç æ–¹å¼ä¹Ÿæ›´å¤šï¼šintã€byteä¸Šå¯ä»¥ä½¿ç”¨å¢é‡ç¼–ç æ¥å¯¹æ•°æ®è¿›è¡Œç¼–ç ã€‚ï¼ˆå¦‚æœéœ€è¦æ”¯æŒå¤æ‚ç±»å‹çš„æ—‹ç”¨parquetæ›´åŠ æœ‰ä¼˜åŠ¿ï¼‰ã€‚åŒæ—¶parqeutä½¿clouderaå’Œtwitteråˆ›å»ºçš„ï¼Œæ‹¥æœ‰æ›´å¹¿çš„é€‚é…æ€§ï¼Œåƒsparké»˜è®¤ä¹Ÿæ˜¯parquetå­˜å‚¨çš„ï¼Œé€‚é…æ€§æ›´å¥½ã€‚</p><p>orcæƒ³å¯¹äºparquetçš„ä¼˜åŠ¿ï¼šæƒ³å¯¹äºparquetï¼Œorcæ”¯æŒacidä»¥åŠupdateæ“ä½œï¼Œå¦‚æœåœ¨hiveä¸Šé¢ä½¿ç”¨acidï¼Œåƒupdate merge deleteè¿™æ ·çš„æ“ä½œå¯ä»¥å®Œç¾çš„æ”¯æŒï¼Œhive3å¯¹äº‹åŠ¡çš„æ”¯æŒæ›´åŠ å®Œå–„äº†ã€‚å› ä¸ºorcå°±æ˜¯ä¸ºhadoopè€Œç”Ÿçš„ï¼Œå¯¹hiveçš„é€‚é…æ€§æ›´å¥½ï¼Œåœ¨hiveä¸Šé¢ä½¿ç”¨æ‹¥æœ‰æ›´å¥½çš„å‹ç¼©æ¯”ä¾‹ä»¥åŠæ›´å¥½çš„æŸ¥è¯¢æ€§èƒ½ã€‚orcçš„æ‹¥æœ‰æ›´ç»†ç²’åº¦çš„ç´¢å¼•ä¿¡æ¯ï¼Œèƒ½å¤Ÿæ›´å¥½çš„æé«˜æŸ¥è¯¢æ€§èƒ½ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>åˆ—å¼å­˜å‚¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
